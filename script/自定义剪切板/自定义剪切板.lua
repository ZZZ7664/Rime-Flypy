--[[

è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.9
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: 5.0.9
æ›´æ–°æ—¥æœŸï¼š2023-08-11
æ›´æ–°ä½œè€…: ä½œè€…ä¸çŸ¥é“è¯¥å†™ä»€ä¹ˆâ€”â€”å­—é¢æ„æ€ 2556814566
æ›´æ–°å†…å®¹ï¼š
        ãƒ»æ–°å¢
          1.å‰ªåˆ‡æ¿å†…å®¹æ»šåŠ¨æ·¡å…¥æ·¡å‡ºï¼Œä½¿æ»šåŠ¨æ›´åŠ å¹³æ»‘ã€‚
          2.æ‰¹é‡åˆ é™¤åŠŸèƒ½
          3.èœå•æŒ‰é’®å¢åŠ æ¸å˜ä¸”é»˜è®¤åœ†è§’æ›´æ–¹ å»ºè®®ä½¿ç”¨ç›¸è¿‘è‰²æ¸å˜
        ãƒ»æ”¹åŠ¨
          1.å¼ƒç”¨Spinneræ§ä»¶æ”¹å†™ä¸ºListViewæ¥é«˜ä»¿Spinnerå¹¶ä¸ºå…¶æ·»åŠ åŠ¨ç”»æ•ˆæœ (BUGåªè¦ä½ çš„æ‰‹é€Ÿå¤Ÿå¿«ï¼Œåœ¨æ”¶èµ·åŠ¨ç”»æœŸé—´æ‰§è¡Œå±•å¼€åŠ¨ç”»å°±ä¼šå¯¼è‡´å¸ƒå±€å¼‚å¸¸ã€‚è¿™ä¸ªBUGæ—¥å¸¸æ ¹æœ¬ä¸ä¼šè§¦å‘ï¼Œåˆè¦æ‰‹é€Ÿåˆè¦è¿ç‚¹ï¼Œé™¤éä½ æƒ³ç»™è‡ªå·±æ‰¾äº‹ï¼Œæ‰€ä»¥æ‡’å¾—ä¿®äº†å¼€æ‘†)
          2.ç²¾ç®€å¸ƒå±€å»é™¤äº†è‡ƒè‚¿æ¨ªå‘åŠŸèƒ½é”®
          3.å°†çŸ­è¯­æ¿ã€åˆ†è¯æ¨¡å—ç¤ºå‰ªåˆ‡æ¿éƒ¨åˆ†å¸ƒå±€åŠŸèƒ½ç­‰ç»Ÿä¸€é£æ ¼
          4.ä¼˜åŒ–é«˜å®½åˆ¤å®šï¼Œé€‚é…å¤šæ•°DPI(éƒ¨åˆ†dpiå¯èƒ½ä¸å°½äººæ„ï¼Œè¿˜æ˜¯å»ºè®®è‡ªå·±æ ¹æ®è®¾å¤‡è°ƒæ•´å¸ƒå±€é«˜å®½)
          5.èƒŒæ™¯æ”¹å›é»˜è®¤å›¾ç‰‡ï¼Œè§†é¢‘èŠ±é‡Œèƒ¡å“¨è¿˜ä¸€å †é—®é¢˜ã€‚ä¾‹ä¸¾ï¼šå­—ä½“é¢œè‰²ä¸è§†é¢‘æ’è‰²ï¼ŒåŠ é®ç½©åˆè·Ÿå¼€äº†æŠ¤çœ¼ä¼¼çš„ã€‚
          6.é»˜è®¤ç¦ç”¨[æ¸…ç†]çš„è¿‡é•¿åˆ é™¤
        ãƒ»BUG
          1.ä¿®å¤Back()åŠŸèƒ½é”®å‡½æ•°ç”Ÿæˆçš„åœ†è§’çš„é”¯é½¿ä½¿å…¶è¾¹è§’æ›´ä¸ºå¹³æ»‘
          2.ä¿®å¤htmlç‰¹æ®Šå­—ç¬¦åœ¨åˆ—è¡¨ä¸­ç”Ÿæ•ˆçš„BUGå¦‚&nbspä¼šæ˜¾ç¤ºä¸ºç©ºæ ¼è€Œä¸æ˜¯å­—ç¬¦&nbsp
          3.ä¿®å¤äºŒç»´ç æ¨¡å—ä¸èƒ½ä¿å­˜æ–‡ä»¶ï¼Œæ·»åŠ åˆ·æ–°MediaStoreä½¿å…¶èƒ½ç«‹å³å‡ºç°äºå›¾åº“å†…
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.8
æ›´æ–°æ—¥æœŸ: 2023-03-28
æ›´æ–°ä½œè€…: ä½œè€…ä¸çŸ¥é“è¯¥å†™ä»€ä¹ˆâ€”â€”å­—é¢æ„æ€ 2556814566
æ›´æ–°å†…å®¹:
        1.æ–°å¢åŠŸèƒ½ ç™¾åº¦ç¿»è¯‘(é•¿æŒ‰å¯é€‰æ‹©è¯­è¨€ç±»å‹) ä¸Šå±é“¾æ¥ å¢åŠ äº†æ¸…ç†æ­£åˆ™ã€‚
        2.ä¼˜åŒ–ã€è¡¥å…¨äº†é•¿æŒ‰èœå•ã€‚
        3.å¢åŠ æ¶Ÿæ¼ªåŠ¨ç”»
        4.å¢åŠ æ¸…ç©ºè¯æ¡é˜²è¯¯è§¦(æ‰‹åŠ¨åè¡€è¡¨æƒ…)
        5.å¢åŠ å¤šåˆ—æ’ç‰ˆåŠŸèƒ½å¼€å¯æ³¨é‡Šï¼Œè¯¦æœGridViewã€‚
        6.ä¿®å¤ä¸€äº›bug,æ³¨é‡Šäº†äº›é‡ç‚¹ï¼å¦‚éŸ³é¢‘ç„¦ç‚¹ã€é€€å‡ºé—ªé»‘å±ç­‰ã€‚
        7.(é—²è¯)æœ€ä¸»è¦è¿˜æ˜¯å› ä¸ºbugå’Œé‡ç‚¹æ³¨é‡Šå¿˜æ ‡äº†æ‰æ›´æ–°çš„åŸæœ¬æ˜¯æ‰“ç®—ä¸æ›´äº†(å®åœ¨æ²¡ä»€ä¹ˆå¥½æ›´çš„äº†),ä½†ä¸€æƒ³åˆ°è¿™æ¶å¿ƒäººçš„bugå°±è§‰å¾—æ˜¯å‘å‡ºæ¥å¯¹åˆ«äººä¸è´Ÿè´£â€¦â€¦ã€‚
        8.å¸¸è§é—®é¢˜ ç­”ç–‘

          âœª: ê¯­å°ê¯­ç™½ê¯­å¿…ê¯­çœ‹ê¯­ï¼å¦‚æœè¦æ›´æ¢è§†é¢‘èƒŒæ™¯ ä¸”æ²¡ç²¾åŠ›æç¬¬ä¸€å¸§ è¯¦æœ main.addView(video, 1)
          ãƒ»:ç°å·²é»˜è®¤å–æ¶ˆï¼ŒåŠŸèƒ½æ˜¯æå‰å…¥å¸ƒå±€ä¸ç­‰å¾…è§†é¢‘åŠ è£æ‰€ä»¥éœ€è¦ç¬¬ä¸€å¸§ä½œä¸ºèƒŒæ™¯ã€‚

          Q:ä¸ºä»€ä¹ˆè§†é¢‘æ˜¯åœ¨è¿›å‰ªåˆ‡æ¿åå¡ä¸€ä¸‹ä¸‹æ‰æ’­æ”¾è§†é¢‘ï¼Ÿè¿›å…¥åå¿«é€Ÿæ»‘åŠ¨åˆ—è¡¨æ»šåŠ¨åˆä¸ºä»€ä¹ˆä¼šä¹Ÿå¡ä¸€ä¸‹ä¸‹ï¼Ÿ
          A:ä¸æ˜¯å¡ä¸€ä¸‹é‚£æ˜¯è§†é¢‘åŠ è½½æ—¶é—´åªä¸è¿‡æå‰è¿›å…¥å‰ªåˆ‡æ¿è€Œå·² è¯¦æƒ… è¯·æœmain.post{run=function() main.addView(video, 1) end}
            ãƒ»ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å› ä¸ºwhile play.getCurrentPosition() <= 1 doè¿˜åœ¨å»¶è¿Ÿåˆ°é»‘å±ç»“æŸ è¿™æœŸé—´ä¼šé˜»æ–­å…¶ä»–ä»£ç  è€Œä½ æå‰è¿›å…¥äº†å‰ªåˆ‡æ¿æ‰€ä»¥ä¼šå¡

          Q:åœ¨å‰ªåˆ‡æ¿å†…æ”¶èµ·é”®ç›˜å†æ‰“å¼€æ€ä¹ˆè®©å…¶ ç»§ç»­æ’­æ”¾æˆ–åœæ­¢æ’­æ”¾
          A:è¯¦æœ -- é‡Šæ”¾èµ„æº æˆ–è€…æœ play.stop()

          Q:ä¸ºä½•è§†é¢‘èƒŒæ™¯æ— å£°éŸ³ï¼Ÿ
          A:play.setVolume(0,0) -- è§†é¢‘å£°éŸ³ å·¦å£°é“ å³å£°é“ å°†0æ”¹ä¸º1å³ç”Ÿæ•ˆ

          Q:å…³äºè§†é¢‘èƒŒæ™¯å†…å­˜å ç”¨å›æ”¶é—®é¢˜ âœªæ³¨ä»¥ä¸‹æ‰€è¯´æ˜¯ä¸­æ–‡çš„å›æ”¶é—®é¢˜ï¼Œä¸é‡Šæ”¾è§†é¢‘èƒŒæ™¯ç¡®å®ä¼šæœ‰å†…å­˜å ç”¨é—®é¢˜ï¼Œä¸è¿‡ä¸åŒæœºå‹æœ‰å¯èƒ½ä¼šè‡ªåŠ¨å›æ”¶æ‰€ä»¥ä¹‹å‰æˆ‘æ²¡æµ‹å‡ºæ¥ã€‚
          A: å…¶å® è¿™æ ¹æœ¬ä¸æ˜¯è§†é¢‘èƒŒæ™¯é—®é¢˜å§ï¼è¯•åŠå¤©äº† ç”¨ä¸ç”¨è§†é¢‘èƒŒæ™¯ ä¸€ç›´å¼€å…³å‰ªåˆ‡æ¿éƒ½ä¼šé€ æˆåƒåœ¾å›æ”¶å¤±è´¥çš„é—®é¢˜ ä¸è®ºè§†é¢‘å¤§å°å¹³å‡å€¼éƒ½æœªå˜åŒ–å·¨å¤§
            ãƒ»ç»è¿‡æµ‹è¯•ï¼Œä¸­æ–‡æœ¬èº«å¯¹luaå›æ”¶å°±æœ‰é—®é¢˜ä»…ä»…åªæœ‰ä¸€è¡Œä»£ç çš„è„šæœ¬ä¹Ÿä¼šé€ æˆå†…å­˜å †ç§¯æ— æ³•é‡Šæ”¾(PSæœ‰æ—¶ä¼šå›æ”¶ï¼Œæœ‰æ—¶ä¼šåœ¨å †å‡ æ¬¡åå†å›æ”¶ï¼Œæœ‰æ—¶ä¼šâ€¦â€¦å ç”¨1G)
            ãƒ»è¿˜æœ‰æ›´å®é”¤çš„ ä¸è£…åº“ ä½ è¿è¡Œä¸€ä¸‹åˆ«çš„è£…äº†åº“çš„è„šæœ¬ å†è¿è¡Œä¸è£…åº“çš„è„šæœ¬ ç…§æ ·èƒ½è·‘ ä½†å¼ºåˆ¶åœæ­¢è¿è¡Œå å†è·‘å°±æŠ¥é”™äº†
            âœªå»ºè®®ä¸å®šæ—¶éƒ¨ç½²æ¥é‡Šæ”¾å†…å­˜æˆ–è€…ç”¨å…¶ä»–æ–¹æ³•ï¼Œå¦‚ç³»ç»Ÿè‡ªå¸¦çš„å®šæ—¶å…³é—­åº”ç”¨ç¨‹åºç­‰ç­‰ã€‚

          bug:æ’­æ”¾è§†é¢‘èƒŒæ™¯æ—¶å¦‚æœåå°çš„å…¶ä»–åº”ç”¨çš„éŸ³ä¹å£°æœ‰ç§è°ƒäº†å‡è¡¡å™¨äº†ä¼¼çš„å£°éŸ³å˜çš„æ€ªæ€ªçš„ è¿™æ˜¯ç¼–ç ã€è§£ç ã€éŸ³é¢‘ç„¦ç‚¹çš„é—®é¢˜
           ãƒ»è§£å†³æ–¹æ³• ä¿®æ”¹è§†é¢‘ä¸ºå…¶ä»–å…¼å®¹ç¡¬è§£ä¸å‡ºé—®é¢˜çš„ç¼–ç æ–¹å¼ è‡³äºä½ æ€ä¹ˆçŸ¥é“è¿™ç§ç¼–ç å’Œä½ ç³»ç»ŸéŸ³ç å™¨æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ
           âœªè¿™ç®€å•å°ç™½æ— è„‘ç”¨å¤§å‚è§†é¢‘å‰ªè¾‘è½¯ä»¶é€‰æ‹©è§†é¢‘ç›´æ¥å¯¼å‡º(ä¸ç”¨ä¿®æ”¹)ä¸€ä¸‹å°±è¡Œäº† å–œæ¬¢æŠ˜è…¾çš„ ffmpeg -i çœ‹ç¼–ç è‡ªå·±è½¬æˆå¯¹åº”çš„
           ãƒ»é—®é¢˜åŸå› è¯¦è§ éŸ³é¢‘ç„¦ç‚¹ å®˜æ–¹æ–‡æ¡£ https://developer.android.com/guide/topics/media-apps/audio-focus?hl=zh-cn
           ãƒ»(åŸæœ¬å†™äº†è¯¦ç»†åŸå› ç»“æœå†™å¤ªé•¿äº†å½±å“è§‚æ„Ÿ å¤§è‡´å°±æ˜¯ æ’­æ”¾è§†é¢‘é»˜è®¤ç¡¬ä»¶è§£ç å…¼å®¹ä¸è¡Œè§£ç å™¨è¢«éŸ³é¢‘ç„¦ç‚¹æ›¿æ¢å¯¼è‡´éŸ³é¢‘è´¨é‡å·®å¼‚......ç•¥) 



è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.7
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.7
æ›´æ–°æ—¥æœŸ: 2023-03-24
æ›´æ–°ä½œè€…: ä½œè€…ä¸çŸ¥é“è¯¥å†™ä»€ä¹ˆâ€”â€”å­—é¢æ„æ€ 2556814566
æ›´æ–°å†…å®¹:
        1. é‡å†™é•¿æŒ‰å¸ƒå±€
          1.1 å¯æ»šåŠ¨åŒåˆ—èœå• ä»¥å…¼å®¹åŸåŠŸèƒ½è¿‡å¤šPopMenuå•åˆ—è¿‡äºè‡ƒè‚¿çš„é—®é¢˜
          1.2 çœç•¥äº†æˆ‘ä¸éœ€è¦çš„åŠŸèƒ½ å¦‚æœ‰éœ€æ±‚è¯·è‡ªè¡Œå¤åˆ¶æ·»åŠ  (æ³¨æ„ScrollViewå®¹å™¨åœ¨å­æ§ä»¶è¶…å‡ºScroollViewåæ‰èƒ½  ê¯­é€šê¯­è¿‡ê¯­æ»‘ê¯­åŠ¨ê¯­å¯ê¯­è§¦ê¯­æ‘¸ê¯­çš„ê¯­å­ê¯­æ§ê¯­ä»¶ê¯­  æ¥æ»šåŠ¨ScrollView)
        2. å¯¹ç‚¹å‡»é•¿æŒ‰ å‰ªåˆ‡æ¿çš„å†…å®¹ æ·»åŠ é«˜äº®é¢œè‰²æç¤º
        3. ä¿®å¤äº†åŠ è½½æ…¢æ—¶ è§†é¢‘é—ªé»‘å±çš„é—®é¢˜ ä½¿ç”¨è§†é¢‘èƒŒæ™¯å‰åŠ¡å¿…çœ‹å®Œè§†é¢‘èƒŒæ™¯åŠŸèƒ½çš„æ³¨é‡Š
        4. åœ¨è„šæœ¬å†…å…³é—­é”®ç›˜é€€å‡ºè„šæœ¬å›åˆ°é”®ç›˜
           4.1 ä¼šé”€æ¯è§†é¢‘æ§ä»¶çš„åŠŸèƒ½(å¦‚é€€å‡ºè„šæœ¬)å‰è¯·åŠ  re_lo = false é˜²æ­¢è¿è¡ŒåŠŸèƒ½åé€€å‡ºè„šæœ¬(å¦‚æœä½ åœ¨è¿”é€€å‡ºè„šæœ¬å‰ä¸åŠ é‚£ä¹ˆå°±ä¼šç›´æ¥å´©æºƒ)
        5. è°ƒæ•´å¸ƒå±€ç®€åŒ–äº†æ— ç”¨åŠŸèƒ½(ä¸ªäººå–œå¥½)
        6. æ ¼å¼åŒ–äº†æ’ä»¶ä¸é«˜äº®çš„ä»£ç (æ’ä»¶æŒ‰å†™æ³•ç”Ÿæˆçš„é«˜äº®)



è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.6
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.6
æ›´æ–°æ—¥æœŸ: 2022-09-10
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
         1. æ·»åŠ å‰ªåˆ‡æ¿æ‰‹åŠ¨æ¸…ç†åŠŸèƒ½
         2. ä¿®å¤å¹¿æ’­ä¼šé‡å¤æ·»åŠ çš„bug
         3. ä½¿ç”¨çš„è‡ªåŠ¨çŠ¶æ€æ ä¸º1.5ç‰ˆæœ¬
         4. ä¼˜åŒ–ä¾èµ–è„šæœ¬åˆ¤æ–­
         5. ä¼˜åŒ–æ ‡é¢˜ä¸Šå‰ªåˆ‡æ¿æ•°é‡çš„æ˜¾ç¤º
         6. ä¿®æ”¹è¿”å›ä¸»é”®ç›˜çš„æ–¹æ³•


è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.5
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.5
æ›´æ–°æ—¥æœŸ: 2022-08-17
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
         1. ä¿®å¤å•ç‹¬å¤åˆ¶ä¸€ä¸ª\n,è„šæœ¬ä¼šå´©æºƒçš„bug
         2. æ·»åŠ è¿›å…¥å‰ªåˆ‡æ¿åè‡ªåŠ¨éšè—çŠ¶æ€æ çš„åŠŸèƒ½
            ï¼ˆéœ€è¦å¯¹åº”luaåŒ…æ”¯æŒï¼Œè¯·å°†è‡ªåŠ¨çŠ¶æ€æ .luaæ”¾å…¥å¯¹åº”ä½ç½®ï¼‰
         3. åˆ é™¤è¯æ¡å’ŒæŸ¥çœ‹è¯æ¡ä¸­çš„åˆ é™¤åŠŸèƒ½ä¼šå®æ—¶å†™å…¥jsonæ–‡ä»¶
         4. æŸ¥çœ‹è¯æ¡ä¸­çš„ç½®é¡¶åŠŸèƒ½ä¼šæ›´æ–°ç³»ç»Ÿçš„å‰ªåˆ‡æ¿ï¼Œç›´æ¥ç²˜è´´ä¼šå˜æˆç½®é¡¶åå†…å®¹
         5. æ¸…ç©ºè¯æ¡çš„æ—¶å€™ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤çŠ¶æ€æ 
         6. å‰ªåˆ‡æ¿æœ‰å˜åŒ–ï¼Œå°±ä¼šå®æ—¶åˆ·æ–°
         7. ä¼˜åŒ–æœç´¢åŠŸèƒ½çš„æ˜¾ç¤º
            7.1 å…³é”®è¯ä¼šæ˜¾ç¤ºåœ¨ç•Œé¢ä¸­
            7.2 å…³é”®è¯ä¼šé«˜äº®


è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.3
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.3
æ›´æ–°æ—¥æœŸ: 2022-06-14
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
          1. ä¿®å¤åˆ†è¯å·¥å…·æ— æ³•ä½¿ç”¨çš„bug


è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.2
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
å½“å‰ç‰ˆæœ¬: V5.0.2
æ›´æ–°æ—¥æœŸ: 2022-05-27
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
          1. ä¿®å¤å‰ªåˆ‡æ¿å†…å®¹æˆ–è€…æœç´¢ç»“æœæ•°é‡è¿‡å°æ—¶ï¼Œå³è¾¹æŒ‰é’®ä¼šå˜å°çš„bug
          2. é‡å†™ä¼˜åŒ–æœç´¢ç›¸å…³åŠŸèƒ½çš„ä»£ç 
          3. ä¿®å¤å‰ªåˆ‡æ¿å†…å®¹æ¡†çš„åºå·ä¸æ˜¯ç”±ç•Œé¢æ§åˆ¶çš„bug
          4. æœç´¢çš„æ—¶å€™æ˜¾ç¤ºçš„åºå·ä¿®æ”¹ä¸ºå…¶çœŸå®åºå·(ä¼šæœ‰ç©ºä½)
          5. å½“å‰ªåˆ‡æ¿å†…å®¹ä¸ºç©ºæˆ–è€…æœç´¢ç»“æœä¸ºç©ºæ—¶ä¼šæœ‰ç›¸å…³æç¤º
          6. æœç´¢æŒ‰é’®çš„æ–‡å­—ä¼šåŠ¨æ€å˜åŒ–
          7. æ›´æ–°è®°å½•ä¸åœ¨æ”¾åœ¨å¸®åŠ©è¯´æ˜å†…éƒ¨è€Œé‡‡ç”¨æ³¨é‡Šçš„å½¢å¼å­˜åœ¨
          8. ä¿®å¤å½“æœç´¢å†…å®¹è¿‡é•¿æ—¶ï¼Œæ ‡é¢˜æ˜¾ç¤ºä¸å…¨çš„é—®é¢˜
          9. å¤åˆ¶å’Œå‰ªåˆ‡åè‡ªåŠ¨åˆ·æ–°å‰ªåˆ‡æ¿
          10. åœ¨æœç´¢ç•Œé¢ä¹Ÿå¯ä»¥å°†è¯æ¡è¿›è¡Œç½®é¡¶åˆ é™¤ç­‰æ“ä½œ
          11. ä¿®å¤ğŸ”ç½®é¡¶è¯æ¡åè¿˜é¡ºä¾¿ç²˜è´´å‡ºåŸæ¥å†…å®¹çš„bug
          

è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0.1
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ›´æ–°æ—¶é—´: 2022å¹´05æœˆ13æ—¥
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
          1. æ ‡é¢˜è¿˜æ˜¯æ·»åŠ äº†ç‰ˆæœ¬å·ï¼Œæ–‡ä»¶åä¸­ä¸æ·»åŠ ç‰ˆæœ¬å·ï¼Œ
             åœ¨æ›´æ–°å‰ªåˆ‡æ¿æ—¶æ— éœ€å†æ¬¡ä¿®æ”¹ä¸»é¢˜
          2. ä¿®å¤æ’¤é”€å’Œé‡åšé•¿æŒ‰ä¹Ÿä¼šæ‰§è¡Œçš„bug
          3. æ›´æ–°äº†å¸ƒå±€

è‡ªå®šä¹‰å‰ªåˆ‡æ¿5.0
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ›´æ–°æ—¶é—´: 2022å¹´05æœˆ12æ—¥
æ›´æ–°ä½œè€…: å°æµ© 3489472862
æ›´æ–°å†…å®¹: 
          1. æ·»åŠ ğŸ”ç½®é¡¶è¯æ¡
          2. é•¿æŒ‰åˆ é™¤é”®å¯ä»¥è¿ç»­åˆ é™¤
          3. é•¿æŒ‰ç©ºæ ¼è¿ç»­è¾“å‡ºç©ºæ ¼
          4. é»˜è®¤é”®ç›˜çš„é”®ç›˜åç”±"K_default"ä¿®æ”¹ä¸º"Keyboard_default"ï¼Œä»¥ä¿®å¤æ— æ³•è¿”å›ä¸»é”®ç›˜çš„bug
          5. æ³¨é‡Šäº†å•å‡»ä¸Šå±å†…å®¹åç›´æ¥ç½®é¡¶çš„åŠŸèƒ½ï¼Œå¦‚æœæƒ³è¦å–æ¶ˆå¯æœç´¢
                  --ç½®é¡¶å·²ä¸Šå±å†…å®¹
                -- Clip.remove(p)
                -- Clip.add(0,s)
                -- fresh(Clip)
          6. å°†æ¸…é™¤åŠŸèƒ½ç§»åˆ°ğŸš®æ¸…ç©ºè¯æ¡é˜²æ­¢è¯¯ç‚¹å‡»
          7. å°†åŸæ¸…é™¤åŠŸèƒ½æ”¹ä¸ºTAB(å¹¶æ²¡ç”¨æ˜¾ç¤ºåœ¨æŒ‰é”®ä¸Š)
          8. ä¿®å¤å¤åˆ¶å¤§é‡å†…å®¹ï¼ˆç½‘é¡µæºç ï¼‰çš„æ—¶å€™å‰ªåˆ‡æ¿æ‰“å¼€å¼‚å¸¸å¡é¡¿çš„bug
          9. ä¿®æ”¹å‰ªåˆ‡æ¿å†…å®¹æ–‡å­—é¢œè‰²ï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²
          10. å‰ªåˆ‡æ¿å†…å®¹åºå·åé¢æ·»åŠ äº†ä¸€ä¸ªç©ºæ ¼
          11. ä¿®æ”¹æ•´ä½“å¸ƒå±€ï¼Œæ·»åŠ äº†ä¸€äº›æŒ‰é”®ï¼ˆå…¨é€‰ï¼Œå¤åˆ¶ï¼Œå‰ªåˆ‡ï¼Œæ’¤é”€ï¼ˆé•¿æŒ‰è¡Œé¦–ï¼‰ï¼Œé‡åšï¼ˆé•¿æŒ‰è¡Œå°¾ï¼‰ï¼Œæ–¹å‘é”®ï¼ˆæ”¯æŒé•¿æŒ‰è¿ç»­ï¼‰ï¼‰
          12. æ·»åŠ èƒŒæ™¯å›¾ç‰‡åŠŸèƒ½ï¼ˆåŒç›®å½•ä¸‹"bg.jpg"çš„å›¾ç‰‡ï¼‰ï¼Œè§†é¢‘èƒŒæ™¯æ”¹ä¸º"bg.mp4",
              å¦‚æœåŒæ—¶å­˜åœ¨è§†é¢‘èƒŒæ™¯å’Œå›¾ç‰‡èƒŒæ™¯ï¼Œä¼˜å…ˆä½¿ç”¨è§†é¢‘èƒŒæ™¯
          13. ä¿®æ”¹é”®ç›˜åçš„åˆ¤å®šæ¡ä»¶ï¼Œé˜²æ­¢è¿”å›æŒ‰é’®è¾“å‡ºæ–‡å­—è€Œæ— æ³•è¿”å›é”®ç›˜
          --14. ç‰ˆæœ¬å·åœ¨æ–‡ä»¶åä¸­æ·»åŠ äº†ï¼Œä¸å†æ ‡é¢˜ä¸­æ·»åŠ ç‰ˆæœ¬å·ï¼Œé˜²æ­¢é‡å¤
          15. ä¿®æ”¹äº†åˆ é™¤è¯æ¡å’Œåˆ†å‰²è¯æ¡å‰é¢çš„emojiè¡¨æƒ…
          16. åˆ é™¤ğŸ“‘å¤åˆ¶è¯æ¡åŠŸèƒ½ï¼Œè¡¨ç¤ºä¸ç†è§£æœ‰ä»€ä¹ˆç”¨
          17. æ·»åŠ ğŸ‘€æŸ¥çœ‹è¯æ¡åŠŸèƒ½ï¼ˆåŸæ¥3ç‚¹å‡ ç‰ˆæœ¬çš„é•¿æŒ‰é¢„è§ˆåŠŸèƒ½ï¼‰
          18. å½“æ²¡æœ‰æ”¾ç½®è§†é¢‘èƒŒæ™¯ä»¥åŠå›¾ç‰‡èƒŒæ™¯æ—¶
              ä¼šè¯»å–å½“å‰ä¸»é¢˜é…è‰²çš„keyboard_back_colorä½œä¸ºå‰ªåˆ‡æ¿èƒŒæ™¯
              æ”¯æŒçº¯è‰²ä»¥åŠå›¾ç‰‡
              **æ³¨æ„: 
              1. è¯¥åŠŸèƒ½éœ€è¦åœ¨å½“å‰ä½¿ç”¨çš„é…è‰²é‡Œé¢è®¾ç½®keyboard_back_color
              2. è®°å¾—éœ€è¦é‡æ–°éƒ¨ç½²ä¸€ä¸‹
          19. èƒŒæ™¯ä¼˜å…ˆçº§ï¼šbg.mp4 > bg.jpg > ä¸»é¢˜é…è‰²èƒŒæ™¯è‰²


æœ¬æ¬¡æ›´æ–°: 2021.10.09
Byï¼ åˆæ¬¢âˆ£hehuan.ys168.com
å¢åŠ ç”ŸæˆäºŒç»´ç ï¼Œå¢åŠ è¯­éŸ³æ’­æŠ¥ï¼Œå¢åŠ ä¸€é”®åŠ è¯è‡ªåŠ¨ç¼–ç ï¼Œå¢åŠ æ¨é€åˆ°äº‘ç«¯ï¼Œå¢åŠ ä»äº‘ç«¯è·å–(ç‚¹å‡»å‰ªåˆ‡æ¿æ ‡é¢˜è·å–)ï¼Œå¢åŠ åˆ†è¯
ä¼˜åŒ–æœç´¢
ç‰ˆæœ¬å·: 4.0

æ— éšœç¢ç‰ˆä¸“ç”¨è„šæœ¬
è„šæœ¬åç§°: è‡ªå®šä¹‰å‰ªåˆ‡æ¿
è¯´æ˜ï¼šä¸­æ–‡è¾“å…¥æ³•æ— éšœç¢ç‰ˆåŸç”Ÿå‰ªåˆ‡æ¿ä¼˜åŒ–ç‰ˆ,åŸºäº æ˜Ÿä¹‚å°˜_è‡ªå®šä¹‰å‰ªåˆ‡æ¿3.1 ä¿®æ”¹
å¢åŠ æœç´¢,ä¼˜å…ˆé¦–é€‰,é€‰ä¸­å†…å®¹
ç‰ˆæœ¬å·: 3.5
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2020å¹´12æœˆ08æ—¥ğŸ—“ï¸
å†œå†: é¼ ğŸåºšå­å¹´åæœˆå»¿å››
æ—¶é—´: 18:26:19ğŸ••
æ˜ŸæœŸ: å‘¨äºŒ
åˆ¶ä½œè€…: é£ä¹‹æ¼«èˆ
é¦–å‘qqç¾¤: Rime åŒæ–‡æ–‹(458845988)
é‚®ç®±: bj19490007@163.com(ä¸ä¸€å®šåŠæ—¶çœ‹åˆ°)


ä¸­æ–‡è¾“å…¥æ³•è„šæœ¬
è‡ªå®šä¹‰å‰ªåˆ‡æ¿
åŸä½œè€…ï¼š æ˜Ÿä¹‚å°˜ 1416165041@qq.com
2020.09.04



</big><font color=red><b>å¸®åŠ©è¯´æ˜</b></font></big>
--è„šæœ¬é…ç½®è¯´æ˜
<b>ç”¨æ³•ä¸€</b>
â‘ æ”¾åˆ°è„šæœ¬å¯åŠ¨å™¨->è„šæœ¬åº“ç›®å½• ä¸‹ä»»æ„ä½ç½®åŠå­æ–‡ä»¶å¤¹ä¸­,è„šæœ¬å¯åŠ¨å™¨è‡ªåŠ¨æ˜¾ç¤ºè¯¥è„šæœ¬
â‘¡ä¸»é¢˜æ–¹æ¡ˆæŒ‚è½½è„šæœ¬å¯åŠ¨å™¨
â‘¢æ˜¾ç¤ºä¸€ä¸ªé”®ç›˜ç•Œé¢,
å•å‡»ä¸Šå±æ–‡å­—

--------------------
<b>ç”¨æ³•äºŒ</b>
ç¬¬â‘ æ­¥ å°† è„šæœ¬æ–‡ä»¶è§£å‹æ”¾ç½® Android/rime/script æ–‡ä»¶å¤¹å†…,
é»˜è®¤è„šæœ¬è·¯å¾„ä¸ºAndroid/rime/script/è‡ªå®šä¹‰å‰ªåˆ‡æ¿/è‡ªå®šä¹‰å‰ªåˆ‡æ¿.lua

ç¬¬â‘¡æ­¥ å‘ä¸»é¢˜æ–¹æ¡ˆä¸­åŠ å…¥æŒ‰é”®
ä»¥ XXX.trime.yamlä¸»é¢˜æ–¹æ¡ˆä¸ºä¾‹
æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹preset_keys,åŠ å…¥ä»¥ä¸‹å†…å®¹

preset_keys:
  lua_script_cvv: {label: å‰ªåˆ‡æ¿, functional: false, send: function, command: "è‡ªå®šä¹‰å‰ªåˆ‡æ¿/è‡ªå®šä¹‰å‰ªåˆ‡æ¿.lua", option: "default"}
å‘è¯¥ä¸»é¢˜æ–¹æ¡ˆä»»æ„é”®ç›˜æŒ‰é”®ä¸­åŠ å…¥ä¸Šè¿°æŒ‰é”®æ—¢å¯

]]




require "import"
import "android.widget.*"
import "android.view.*"
import "android.graphics.RectF"
import "android.media.MediaPlayer"
import "android.graphics.drawable.StateListDrawable"
import "java.io.File"
import "android.text.Html"
import "android.os.*"
import "com.osfans.trime.*" --è½½å…¥åŒ…
import "android.graphics.Typeface"
import "android.content.Context" 
import "android.speech.tts.*"
import "yaml"
import "java.math.BigInteger"
import "android.content.res.ColorStateList"
import "android.graphics.Color"
import "android.graphics.drawable.GradientDrawable"
import "android.graphics.drawable.RippleDrawable"
import "android.view.animation.*"


local è¾“å…¥æ³•ç›®å½•=tostring(service.getLuaExtDir("")).."/"
local è„šæœ¬ç›®å½•=tostring(service.getLuaExtDir("script")).."/"
local è„šæœ¬è·¯å¾„=debug.getinfo(1,"S").source:sub(2)--è·å–Luaè„šæœ¬çš„å®Œæ•´è·¯å¾„
local çº¯è„šæœ¬å=File(è„šæœ¬è·¯å¾„).getName()
local ç›®å½•=string.sub(è„šæœ¬è·¯å¾„,1,#è„šæœ¬è·¯å¾„-#çº¯è„šæœ¬å)
local è„šæœ¬ç›¸å¯¹è·¯å¾„=string.sub(è„šæœ¬è·¯å¾„,#è„šæœ¬ç›®å½•+1)
local è„šæœ¬ç›¸å¯¹ç›®å½•=string.sub(è„šæœ¬ç›¸å¯¹è·¯å¾„,1,-#çº¯è„šæœ¬å-1)
local ä¸»é¢˜ç»„=Config.get()
local å½“å‰ä¸»é¢˜0=ä¸»é¢˜ç»„.getTheme()
local ä¸»é¢˜æ–‡ä»¶=è¾“å…¥æ³•ç›®å½•.."build/"..å½“å‰ä¸»é¢˜0..".yaml"
local yamlç»„ = yaml.load(io.readall(ä¸»é¢˜æ–‡ä»¶))

local ç‰ˆæœ¬å·="5.0.6"
local æ ‡é¢˜=("")--çº¯è„šæœ¬å:sub(1,-5) .. ç‰ˆæœ¬å·
local clipMaxNum = Function.getPref(this).getString("clipboard_size", "120")

re_lo = true -- é˜²æ­¢ç‚¹å‡»è¿”å›æ—¶è§†é¢‘èƒŒæ™¯è‡ªåŠ¨è¿”å›2æ¬¡ç›´æ¥å´©æºƒ

if File(è¾“å…¥æ³•ç›®å½• .. "script/åŒ…/é”®ç›˜æ“ä½œ/åŠŸèƒ½é”®.lua").exists() then
  import "script.åŒ….é”®ç›˜æ“ä½œ.åŠŸèƒ½é”®"
end

if File(è¾“å…¥æ³•ç›®å½• .. "script/åŒ…/é”®ç›˜æ“ä½œ/è‡ªåŠ¨çŠ¶æ€æ .lua").exists() then
  import "script.åŒ….é”®ç›˜æ“ä½œ.è‡ªåŠ¨çŠ¶æ€æ "
end


--ç”¨äºæ¸…ç©ºè¯æ¡
local æ–‡ä»¶=tostring(service.getLuaDir("")).."/clipboard.json"

local Clip=service.getClipBoard()

local func_fresh = nil
local func_ss = nil

-- è¾…åŠ©å‡½æ•°------------å¼€å§‹------------

--é•¿æŒ‰è¿ç»­æŒ‰é”®
local ButLongclick = (function(key)
  local height = 0
  return {
    onTouch = function(v, e)
      local a = e.getAction()
      if a == 0 then -- æŒ‰ä¸‹
        service.sendEvent(key)
        height = v.getHeight()
      elseif a == 1 then -- æŠ¬æŒ‡
        ti.stop()
      elseif a == 2 then -- æ»‘åŠ¨
        if tick[1] then
          local y = e.getY()
          if e.getX() < 1 or y < 1 or y > height then
            ti.stop()
          end
        end
      end
    end,
    onLongClick = function()
      ti = Ticker()
      ti.Period = 80
      ti.onTick = function()
        service.sendEvent(key)
      end
      ti.start()
      return true
    end
  }
end)


--è½¬ä¸ºæ•´æ•°
local function toint(n)
  local s = tostring(n)
  local i, j = s:find('%.')
  if i then
    return tonumber(s:sub(1, i-1))
  else
    return n
  end
end

--å¯¼å…¥æ¨¡å—
function å¯¼å…¥æ¨¡å—(æ¨¡å—,å†…å®¹)
   dofile_ä¿¡æ¯è¡¨=nil
   dofile_ä¿¡æ¯è¡¨={}
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬=è„šæœ¬è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬æ‰€åœ¨ç›®å½•=ç›®å½•
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬ç›¸å¯¹è·¯å¾„=è„šæœ¬ç›¸å¯¹è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.çº¯è„šæœ¬å= çº¯è„šæœ¬å:sub(1,-5)
   dofile_ä¿¡æ¯è¡¨.å†…å®¹=å†…å®¹
   dofile(ç›®å½•..æ¨¡å—)--å¯¼å…¥æ¨¡å—
end

function rippleDrawable(color)
  import"android.content.res.ColorStateList"
  return activity.Resources.getDrawable(activity.obtainStyledAttributes({android.R.attr.selectableItemBackground--[[Borderless]]}).getResourceId(0,0)).setColor(ColorStateList(int[0].class{int{}},int{color or 0x20000000}))
end

--çº¿æ€§æ¸å˜
function gradientDrawable(orientation,colors)
  import"android.graphics.drawable.GradientDrawable"
  return GradientDrawable(GradientDrawable.Orientation[orientation],colors)
end

--æ³¨å†Œå‰ªåˆ‡æ¿æ·»åŠ å¹¿æ’­
import "android.content.BroadcastReceiver"
import "android.content.IntentFilter"
import "com.androlua.LuaBroadcastReceiver"
function å‰ªåˆ‡æ¿æ·»åŠ å¹¿æ’­()
  br=LuaBroadcastReceiver(LuaBroadcastReceiver.OnReceiveListener{
    onReceive=function(context, intent)
      if intent.getAction()=="com.nirenr.talkman.ACTION_ADD_CLIPBOARD" then
        if intent.getStringExtra("com.nirenr.talkman.EXTRA_TEXT_DATA")~="" or intent.getStringExtra("com.nirenr.talkman.EXTRA_TEXT_DATA")~=nil then
          func_fresh()
        end --intent.getStringExtra
      end --intent.getAction
    end --function(conte
  })
  --åŠ¨æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶è€…
  filter=IntentFilter()
  filter.addAction("com.nirenr.talkman.ACTION_ADD_CLIPBOARD")
  filter.setPriority(Integer.MAX_VALUE)
  --å¼€å¯å¹¿æ’­æ¥æ”¶
  service.registerReceiver(br,filter)
  å…¨_br = true
end
  
--æ¸…ç†å‰ªåˆ‡æ¿
local function clipClean()
  -- print("clip clean...")
  local æ¸…ç†æ­£åˆ™ç»„={
--  "^http%S*$", -- æ¸…ç†çº¯é“¾æ¥
    "ç¬¬%d+æ®µ%sé€Ÿåº¦.*å‡»é”®", -- æ¸…ç†ç»ƒä¹ æˆç»©
    "ç¬¬%d+æ®µ%-ä½™%d+å­—", -- æ¸…ç†å‘æ–‡
--    "^$[a-z].*[0-9].*$$", -- æ¸…ç†æŸè´´å§å•æ‰€
--    "^2233 h%S*$", -- æ¸…ç†æŸ2233ç«™
--    "[a-z:/]*[a-z].kuaishou.*", -- æ¸…ç†æŸæ‰‹
  }
  local zs = 0
  --å€’åºå¾ªç¯
  for i=#Clip-1, 0, -1 do
    --è¿‡é•¿åˆ é™¤
    -- if #Clip[i] > 1000 then
    --   zs = zs + 1
    --   Clip.remove(i)
    -- end

    -- æ­£åˆ™æ¸…ç†
    for j=1, #æ¸…ç†æ­£åˆ™ç»„ do
      if string.find(Clip[i], æ¸…ç†æ­£åˆ™ç»„[j]) ~= nil then
        zs = zs + 1
        Clip.remove(i)
      end
    end
  end
  print("å…±æ¸…ç†" .. zs .. "æ¡æ•°æ®")
  func_fresh()
end


-- è¾…åŠ©å‡½æ•°------------ç»“æŸ------------

-- å­—ä½“è®¾ç½®------------å¼€å§‹------------

local vibeFont=Typeface.DEFAULT
local å­—ä½“æ–‡ä»¶ = tostring(service.getLuaDir("")).."/fonts/ç‰›ç é£æœºæ‰‹æœº5ä»£è¶…é›†å®‹ä½“.ttf"
if File(å­—ä½“æ–‡ä»¶).exists()==true then
  vibeFont=Typeface.createFromFile(å­—ä½“æ–‡ä»¶)
end--if File(å­—ä½“æ–‡ä»¶)

-- å­—ä½“è®¾ç½®------------ç»“æŸ------------


-- è‡ªåŠ¨èƒŒæ™¯é¢œè‰²å’ŒèƒŒæ™¯å›¾ç‰‡------------å¼€å§‹------------

local èƒŒæ™¯é¢œè‰² = nil
--å›¾ç‰‡è·¯å¾„
local bgpic_path=ç›®å½•.."bg.jpg"
local å½“å‰é…è‰²ID=Config.get().getColorScheme()
local å½“å‰é…è‰²èƒŒæ™¯ = yamlç»„["preset_color_schemes"][å½“å‰é…è‰²ID]["keyboard_back_color"]
local å½“å‰é…è‰²èƒŒæ™¯é¢œè‰² = toint(å½“å‰é…è‰²èƒŒæ™¯)

if å½“å‰é…è‰²èƒŒæ™¯é¢œè‰² ~= nil then
    èƒŒæ™¯é¢œè‰² = "0x" .. BigInteger(tostring(å½“å‰é…è‰²èƒŒæ™¯é¢œè‰²), 10).toString(16)
elseif å½“å‰é…è‰²èƒŒæ™¯ ~= nil and not File(bgpic_path).isFile() then
    bgpic_path = è¾“å…¥æ³•ç›®å½• .. "backgrounds/" .. å½“å‰é…è‰²èƒŒæ™¯ -- æ˜¯èƒŒæ™¯å›¾ç‰‡
end

-- è‡ªåŠ¨èƒŒæ™¯é¢œè‰²å’ŒèƒŒæ™¯å›¾ç‰‡------------ç»“æŸ------------


-- æœç´¢åŠŸèƒ½------------å¼€å§‹------------
-- ä¼˜å…ˆçº§
-- å‚æ•° >> çŠ¶æ€æ  >> é€‰ä¸­æ–‡æœ¬ >> ä¸Šæ¬¡ä¸Šå±
-- è¿™é‡Œä¸è€ƒè™‘å¯åŠ¨å‚æ•°
local é¢„æœç´¢å†…å®¹ = ""
local isSearch = false
local function getSearchStr()
    if Rime.RimeGetInput() ~= "" then
        é¢„æœç´¢å†…å®¹ = Rime.getComposingText() -- å½“å‰å€™é€‰
    else
        é¢„æœç´¢å†…å®¹ = service.getCurrentInputConnection().getSelectedText(0) -- å–ç¼–è¾‘æ¡†é€‰ä¸­å†…å®¹,éƒ¨åˆ†appå†…æ— æ•ˆ
    end
    if é¢„æœç´¢å†…å®¹ == "" or é¢„æœç´¢å†…å®¹ == nil then
        é¢„æœç´¢å†…å®¹ = Rime.getCommitText() -- å·²ä¸Šå±æ–‡å­—
    end
end
-- è§£é™¤ä¸‹é¢æ³¨é‡Šåˆ™å¯åŠ¨ç«‹åˆ»è¿›è¡Œæœç´¢
-- getSearchStr()
if é¢„æœç´¢å†…å®¹ ~= "" and é¢„æœç´¢å†…å®¹ ~= nil then
    isSearch = true
end
-- æœç´¢åŠŸèƒ½------------ç»“æŸ------------



local num = 0 --å½“å‰é€‰æ‹©çš„åºå·
local str = "" --å½“å‰é€‰æ‹©çš„å†…å®¹
local arrNo={} --å†…å®¹åºå·æ•°ç»„ï¼Œé‡Œé¢ä¿å­˜Clipçš„ä½ç½®åºå·
local function getNumStr(p)
  num = arrNo[p+1]
  str = Clip[num]
end


-- ç”ŸæˆåŠŸèƒ½é”®èƒŒæ™¯
local function Back(color,light,radius) 
  if radius == nil then
    radius = 20
  end
  local bka=LuaDrawable(function(c,p,d)
  local b=d.bounds
  b=RectF(b.left,b.top,b.right,b.bottom)
  p.setColor(light) -- é«˜äº®é¢œè‰²
  p.setAntiAlias(true) -- å¼€å¯æŠ—é”¯é½¿
  c.drawRoundRect(b,radius,radius,p) --åœ†è§’20
  end)
  local bkb=LuaDrawable(function(c,p,d)
  local b=d.bounds
  b=RectF(b.left,b.top,b.right,b.bottom)
  p.setColor(color) -- é»˜è®¤é¢œè‰²
  p.setAntiAlias(true) -- å¼€å¯æŠ—é”¯é½¿
  c.drawRoundRect(b,radius,radius,p)
  end)


local stb,state=StateListDrawable(),android.R.attr.state_pressed
  stb.addState({-state},bkb)
  stb.addState({state},bka)
  return stb
end

-- æ¶Ÿæ¼ªåŠ¨ç”»åŠŸèƒ½é”®
local function create_ripp(noColor,prColor,radius,grColor)
    local rippleColor = prColor or 0xFF0000FF  -- é»˜è®¤ æŒ‰ä¸‹ çŠ¶æ€é¢œè‰²
    local defaultColor = noColor or 0xFFFFFFFF -- é»˜è®¤ æœªæŒ‰ä¸‹ çŠ¶æ€é¢œè‰²
    if radius == nil then
        radius = 30
    end
    if grColor == nil then
        grColor = defaultColor
    end
    -- å®šä¹‰å››ç§çŠ¶æ€é¢œè‰²
    local states = {
        {android.R.attr.state_pressed},   -- æŒ‰ä¸‹
        {android.R.attr.state_focused},   -- ç„¦ç‚¹
        {android.R.attr.state_activated}, -- é«˜äº®
        {} --é»˜è®¤
    }
    local stateColorList = {
        rippleColor, -- æ¶Ÿæ¼ªé¢œè‰² çŠ¶æ€å¯¹åº”states
        rippleColor,
        rippleColor,
        defaultColor -- é»˜è®¤é¢œè‰²
    }

    -- åˆ›å»ºColorStateListå¯¹è±¡
    local colorStateList = ColorStateList(states, stateColorList)

    -- åˆ›å»ºRippleDrawableå¯¹è±¡
    local mask = GradientDrawable()
    mask.setColor(0xFFFFFFFF)
    mask.setStroke(2, rippleColor)
    mask.setCornerRadius(radius) -- åŠ¨ç”»åœ†è§’ è®¾ç½®åœ†è§’åŠå¾„ä¸ºæå¤§å€¼ï¼Œä½¿å…¶å˜æˆåœ†å½¢

    local contentDrawable = GradientDrawable()
    local colors = {grColor, defaultColor} -- æ¸å˜è‰²
    contentDrawable.setColors(colors) -- è®¾ç½®æ¸å˜è‰²
    -- contentDrawable.setGradientType(GradientDrawable.LINEAR_GRADIENT) -- è®¾ç½®æ¸å˜ç±»å‹ä¸ºçº¿æ€§æ¸å˜
    -- contentDrawable.setOrientation(GradientDrawable.Orientation.LEFT_RIGHT) -- è®¾ç½®æ¸å˜æ–¹å‘ä¸ºä»å·¦è‡³å³
    contentDrawable.setCornerRadius(radius) -- é»˜è®¤çŠ¶æ€åœ†è§’ è®¾ç½®åœ†è§’åŠå¾„ä¸ºæå¤§å€¼ï¼Œä½¿å…¶å˜æˆåœ†å½¢

    local rippleDrawable = RippleDrawable(colorStateList, contentDrawable, mask)
    return rippleDrawable
end


--è·å–kåŠŸèƒ½å›¾æ ‡ï¼Œæ²¡æœ‰åˆ™è¿”å›s
local function Icon(k,s) 
  k=Key.presetKeys[k]
  return k and k.label or s
end

-- ç”ŸæˆåŠŸèƒ½é”®

local function Bu_R(id)
  local ta = {
    TextView,
    gravity = 17,
    background = Back(0x49d3d7da, 0x49ffffff),
    layout_height = -1,
    layout_width = -1,
    layout_weight = 1,
    layout_margin = "1dp",
    layout_marginTop = "2dp",
    layout_marginBottom = "2dp",
    textColor = 0xFFFFFFFF,
    -- textColor = 0xff232323,
    textSize = "18dp"
  }

  if id == 1 then
    ta.text = Icon("BackSpace", "âŒ«")
    ta.textSize = "18dp" -- å­—ä½“å¤§å°è®¾ç½®ä¸º22dp
    ta.onTouchListener = ButLongclick("BackSpace")
    ta.onLongClickListener = ButLongclick("BackSpace")
  elseif id == 2 then
    ta.text = "ç©ºæ ¼"
    ta.textSize = "18dp"
    ta.onTouchListener = ButLongclick("space")
    ta.onLongClickListener = ButLongclick("space")
  elseif id == 3 then
    ta.text = Icon("Return", "â")
    ta.textSize = "18dp"
    ta.onClick = function()
      service.sendEvent("Return")
    end
    ta.onLongClickListener = { onLongClick = function() return true end }
  elseif id == 4 then
    ta.text = Icon("è¿”å›", "è¿”å›")
    ta.onClick = function()
      re_lo = false -- é˜²æ­¢ç‚¹å‡»è¿”å›æ—¶è§†é¢‘èƒŒæ™¯è‡ªåŠ¨è¿”å›2æ¬¡ç›´æ¥å´©æºƒ
      service.setKeyboard(".default")
      pcall(function()
        -- pcallé‡Œé˜²æŠ¥é”™
        æ¢å¤çŠ¶æ€æ ()
      end)
    end
    ta.onLongClickListener = {
      onLongClick = function()
        service.setKeyboard(".default")
        pcall(function()
          -- pcallé‡Œé˜²æŠ¥é”™
          æ¢å¤çŠ¶æ€æ ()
        end)
        return true
      end
    }
  elseif id == 5 then
    ta.text = Icon("Tab", "Tab")
    ta.textSize = "18dp"
    ta.onClick = function()
      service.sendEvent("Tab")
    end
    ta.onLongClickListener = { onLongClick = function() return true end }
  elseif id == 6 then
    ta.text = "å¸®åŠ©"
    ta.onClick = function()
      å¯¼å…¥æ¨¡å—("å¸®åŠ©æ¨¡å—.text", å¸®åŠ©å†…å®¹)
    end
    ta.onLongClickListener = { onLongClick = function() return true end }
  elseif id == 7 then
    ta.text = Icon("å…¨é€‰", "å…¨é€‰")
    ta.textSize = "18dp"
    ta.onClick = function()
      if åŠŸèƒ½_å…¨é€‰ ~= nil then
        åŠŸèƒ½_å…¨é€‰()
      else
        print('ã€å…¨é€‰ã€‘åŠŸèƒ½éœ€è¦"åŠŸèƒ½é”®.lua"çš„æ”¯æŒï¼è¯·ç¡®ä¿"script/åŒ…/é”®ç›˜æ“ä½œ/åŠŸèƒ½é”®.lua]æ–‡ä»¶å­˜åœ¨"')
      end
    end
  elseif id == 8 then
    ta.text = Icon("å¤åˆ¶", "å¤åˆ¶")
    ta.textSize = "18dp"
    ta.onClick = function()
      if åŠŸèƒ½_å¤åˆ¶ ~= nil then
        åŠŸèƒ½_å¤åˆ¶()
      else
        print('ã€å¤åˆ¶ã€‘åŠŸèƒ½éœ€è¦"åŠŸèƒ½é”®.lua"çš„æ”¯æŒï¼è¯·ç¡®ä¿"script/åŒ…/é”®ç›˜æ“ä½œ/åŠŸèƒ½é”®.lua]æ–‡ä»¶å­˜åœ¨"')
      end
      -- å¿…é¡»è¦æœ‰å»¶æ—¶
      -- task(80,function func_fresh() end)
    end
  elseif id == 9 then
    ta.text = Icon("å‰ªåˆ‡", "å‰ªåˆ‡")
    ta.textSize = "18dp"
    ta.onClick = function()
      if åŠŸèƒ½_å‰ªåˆ‡ ~= nil then
        åŠŸèƒ½_å‰ªåˆ‡()
      else
        print('ã€å‰ªåˆ‡ã€‘åŠŸèƒ½éœ€è¦"åŠŸèƒ½é”®.lua"çš„æ”¯æŒï¼è¯·ç¡®ä¿"script/åŒ…/é”®ç›˜æ“ä½œ/åŠŸèƒ½é”®.lua]æ–‡ä»¶å­˜åœ¨"')
      end
      -- å¿…é¡»è¦æœ‰å»¶æ—¶
      -- task(80,function func_fresh() end)
    end
  elseif id == 10 then
    ta.id = "ss" -- ss: æœç´¢
    if isSearch then
      ta.text = Icon("å…¨éƒ¨", "å…¨éƒ¨")
    else
      ta.text = Icon("æœç´¢", "æœç´¢")
    end
    ta.textSize = "18dp"
    ta.onClick = function()
      if isSearch then
        isSearch = false
        func_ss("æœç´¢")
      else
        isSearch = true
        func_ss("å…¨éƒ¨")
      end
      getSearchStr()
      func_fresh()
    end
  elseif id == 11 then
    ta.text = Icon("çŸ­è¯­", "çŸ­è¯­")
    ta.textSize = "18dp"
    ta.onClick = function()
      if åŠŸèƒ½_è„šæœ¬ ~= nil then
        åŠŸèƒ½_è„šæœ¬(è„šæœ¬ç›¸å¯¹ç›®å½•.."è‡ªå®šä¹‰çŸ­è¯­æ¿.lua", "å‰ªåˆ‡æ¿")
      else
        print('ã€è„šæœ¬ã€‘åŠŸèƒ½éœ€è¦"åŠŸèƒ½é”®.lua"çš„æ”¯æŒï¼è¯·ç¡®ä¿"script/åŒ…/é”®ç›˜æ“ä½œ/åŠŸèƒ½é”®.lua]æ–‡ä»¶å­˜åœ¨"')
      end
    end
  elseif id == 12 then
    ta.text = Icon("æ’¤é”€", "æ’¤é”€")
    ta.textSize = "18dp"
    ta.onClick = function()
      service.sendEvent("undo")
    end
    ta.onLongClickListener = {
      onLongClick = function()
        -- é•¿æŒ‰è¡Œé¦–
        service.sendEvent("Home")
        return true
      end
    }
  elseif id == 13 then
    ta.text = Icon("é‡åš", "é‡åš")
    ta.textSize = "18dp"
    ta.onClick = function()
      service.sendEvent("redo")
    end
    ta.onLongClickListener = {
      onLongClick = function()
        -- é•¿æŒ‰è¡Œå°¾
        service.sendEvent("End")
        return true
      end
    }
  elseif id == 14 then
    ta.text = "â†"
    ta.textSize = "18dp"
    ta.onTouchListener = ButLongclick("Left")
    ta.onLongClickListener = ButLongclick("Left")
  elseif id == 15 then
    ta.text = "â†“"
    ta.textSize = "18dp"
    ta.onTouchListener = ButLongclick("Down")
    ta.onLongClickListener = ButLongclick("Down")
  elseif id == 16 then
    ta.text = "â†‘"
    ta.textSize = "18dp"
    ta.onTouchListener = ButLongclick("Up")
    ta.onLongClickListener = ButLongclick("Up")
  elseif id == 17 then
    ta.text = "â†’"
    ta.textSize = "18dp"
    ta.onTouchListener = ButLongclick("Right")
    ta.onLongClickListener = ButLongclick("Right")
  elseif id == 18 then
    ta.text = "æ¸…ç†"
    ta.textSize = "18dp"
    ta.onClick = function()
      clipClean()
    end
    ta.onLongClickListener = { onLongClick = function() return true end }
  end
  return ta
end


local é»˜è®¤é«˜åº¦ = service.getLastKeyboardHeight()
if é»˜è®¤é«˜åº¦ < 300 then 
    é»˜è®¤é«˜åº¦ = 300 
end


-- ä¸»ç•Œé¢å¸ƒå±€
local ids, layout = {}, {
  FrameLayout,
  -- é”®ç›˜é«˜åº¦
  layout_height = é»˜è®¤é«˜åº¦,
  layout_width = -1,
  -- èƒŒæ™¯é¢œè‰²
  BackgroundColor = èƒŒæ™¯é¢œè‰²,
  {
    TextView,
    id = "title",
    layout_height = "20dp",
    layout_width = -1,
    text = "â€¢å¸®åŠ©è¯´æ˜",
    textColor = "#FFFFFFFF",
    gravity = "center",
    paddingLeft = "2dp",
    paddingRight = "2dp",
    singleLine = "true",
    -- BackgroundColor = 0x49d3d7da,
  },
  {
    LinearLayout,
    orientation = 0, -- æ°´å¹³å¸ƒå±€
    layout_height = -1,
    {
      LinearLayout,
      orientation = 1, -- å‚ç›´å¸ƒå±€
      layout_weight = 1,
      layout_height = -1,
      {
        LinearLayout,
        layout_marginTop = "20dp", -- å’Œæ ‡é¢˜é«˜åº¦ç›¸ç­‰
        orientation = 0, -- æ°´å¹³å¸ƒå±€
        layout_width = -1,
        layout_height = "0dp",
        -- layout_height = "39dp",
        -- è‹¥è¦ä½¿ç”¨å…¶ä¸‹æŒ‰é”®è¯·è®¾ç½®heightçš„é«˜åº¦
        -- Bu_R(4),
        -- Bu_R(7),
        -- Bu_R(9),
        -- Bu_R(8),
        -- Bu_R(12),
        -- Bu_R(14),
        -- Bu_R(15),
        -- Bu_R(16),
        -- Bu_R(17),
      },
      {
        ListView, -- æ”¹ä¸ºGridViewå¯è®¾ç½®å¤šåˆ—æ’ç‰ˆ è®°å¾—æ”¹TV_bçš„MinHeightæ¨è60dp
        id = "list",
        -- NumColumns=2, -- åˆ—æ•° æ§ä»¶æ”¹ä¸ºGridViewæ—¶ç”Ÿæ•ˆ
        -- layout_marginTop="59dp", -- å’Œæ ‡é¢˜é«˜åº¦ç›¸ç­‰
        -- DividerHeight=0,  -- æ— åˆ†å‰²çº¿
        layout_width = -1,
        layout_weight = 1,
      },
    },
    {
      LinearLayout,
      -- layout_marginTop="59dp", -- å’Œæ ‡é¢˜é«˜åº¦ç›¸ç­‰
      layout_marginTop = "20dp", -- å’Œæ ‡é¢˜é«˜åº¦ç›¸ç­‰
      orientation = 1,
      layout_weight = 1,
      layout_width = "130dp",
      layout_height = -1,
      layout_gravity = 5 | 84,
      -- Bu_R(11),
      Bu_R(4),
      Bu_R(18),
      Bu_R(10),
      Bu_R(3),
      Bu_R(1),
    },
  },
}

main=loadlayout(layout,ids)

--å‰ªåˆ‡æ¿å†…å®¹æ¡†
local data,item={},{LinearLayout,
  layout_width=-1,
  id = "TV_z",
  padding="4dp",
  gravity=3|17,
  {TextView,
    id="TV_a",
    textColor=0xFF6282D2,
    textSize="17dp"
  },
  {TextView,
    id="TV_b",
    gravity=3|17,
    paddingLeft="4dp",
    --æœ€å¤§æ˜¾ç¤ºè¡Œæ•°
    MaxLines=3,
    --æœ€å°é«˜åº¦
    MinHeight="30dp",
    Typeface=vibeFont,
    textColor=0xFFFFFFFF,
    textSize="15dp"
  }
}


local adp=LuaAdapter(service,data,item)
ids.list.Adapter=adp

local function fresh()
  -- print("fresh")
  table.clear(data)
  table.clear(arrNo)

  local æ­£åˆ™å¼ = ""
  if isSearch then
    for i = 0, #Clip - 1 do
      local m = utf8.find(Clip[i], é¢„æœç´¢å†…å®¹)
      if m ~= nil then
        table.insert(arrNo, i)
      end
    end
    ids.title.setText(æ ‡é¢˜ .. "(æœç´¢åˆ°" .. #arrNo .. "æ¡) \"" .. é¢„æœç´¢å†…å®¹ .. "\" ç›¸å…³å†…å®¹")
    æ­£åˆ™å¼ = "(\n*[^\n]*)([^\n]*" .. é¢„æœç´¢å†…å®¹ .. "[^\n]*)(\n*[^\n]*)"
  else
    for i = 0, #Clip - 1 do
      arrNo[i + 1] = i
    end
    ids.title.setText(æ ‡é¢˜ .. "(" .. #arrNo .. "/" .. clipMaxNum .. ")")
    æ­£åˆ™å¼ = "(\n*[^\n]*)(\n*[^\n]*)(\n*[^\n]*)"
  end

  for i = 1, #arrNo do
    local v = Clip[arrNo[i]]
    local a, b, c = v:match(æ­£åˆ™å¼)
    a = table.concat{utf8.sub(a or "", 1, 99), utf8.sub(b or "", 1, 99), utf8.sub(c or "", 1, 99)}
    a = string.gsub(a, "\n", "<br>")
    -- & åé¢è·Ÿäº†ä¸ªu200B é›¶å®½ç©ºæ ¼å­—ç¬¦ ä»¥é˜²æ­¢htmlè¯†åˆ«å…¶ä¸ºç‰¹æ®Šå­—ç¬¦ å¦‚&nbsp; ç©ºæ ¼
    a = string.gsub(a, "&", "&â€‹")
    if isSearch then
      a = string.gsub(a, é¢„æœç´¢å†…å®¹, "<font color=#00ff00>" .. é¢„æœç´¢å†…å®¹ .. "</font>")
    end
    table.insert(data, {TV_a = Html.fromHtml("</big><font><b>" .. tostring(arrNo[i] + 1) .. ". </b></font></big>"), TV_b = Html.fromHtml(a), TV_z={background=Back(0x00,0x79DBDBDB,0)}})
  end

  if #arrNo == 0 then
    if isSearch then
      table.insert(data, {TV_a = Html.fromHtml("</big><font><b>" .. tostring(1) .. ". </b></font></big>"), TV_b = Html.fromHtml("æœªæœç´¢åˆ°ã€" .. "<font color=#00ff00>" .. é¢„æœç´¢å†…å®¹ .. "</font>" .. "ã€‘ç›¸å…³å†…å®¹")})
    else
      table.insert(data, {TV_a = Html.fromHtml("</big><font><b>" .. tostring(1) .. ". </b></font></big>"), TV_b = Html.fromHtml("å‰ªåˆ‡æ¿ä¸­æ— å†…å®¹ï¼")})
    end
  end

  adp.notifyDataSetChanged()
  func_ss = ids.ss.setText -- åˆ·æ–°ä»¥åidä¼šé‡ç½®
end


-- åˆ—è¡¨æ»šåŠ¨äº‹ä»¶
ids.list.setOnScrollChangeListener{
  onScrollChange = function(view, scrollX, scrollY, oldScrollX, oldScrollY)
    -- è·å–å¯è§†èŒƒå›´å†…ç¬¬ä¸€ä¸ªitemçš„ä½ç½®
    local firstVisibleItem = view.getFirstVisiblePosition()
    -- è·å–å¯è§†èŒƒå›´å†…æœ€åä¸€ä¸ªitemçš„ä½ç½®
    local lastVisibleItem = view.getLastVisiblePosition()

    -- éå†å¯è§†çš„item
    for i = firstVisibleItem, lastVisibleItem do
      -- éå‰ä½ç½®å‡å»å¯è§†èŒƒå›´å†…ç¬¬ä¸€ä¸ªitemè®¡ç®—å½“å‰itemåœ¨ListViewä¸­çš„ç´¢å¼•ä½ç½®
      local itemView = ids.list.getChildAt(i - firstVisibleItem)

      -- è·å–itemViewåœ¨å±å¹•ä¸Šçš„é¡¶éƒ¨ä½ç½®
      local item_top = itemView.getTop()
      -- è·å–itemViewåœ¨å±å¹•ä¸Šçš„åº•éƒ¨ä½ç½®
      local item_bottom = itemView.getBottom()
      -- è·å–itemViewåœ¨å±å¹•ä¸Šçš„é«˜åº¦
      local item_height = itemView.getHeight()
      -- è·å–å½“å‰viewåœ¨å±å¹•ä¸Šçš„é«˜åº¦
      local height = view.getHeight()

      -- è®¡ç®—itemViewåœ¨å±å¹•ä¸Šçš„æ¯”ä¾‹
      -- å…¬å¼ (itemåº•éƒ¨ä½ç½® - å‚ç›´æ»‘åŠ¨è·ç¦»)åº•éƒ¨è‡³é¡¶éƒ¨çš„æ»šåŠ¨è·ç¦»;(item åº•éƒ¨ä½ç½® - itemé¡¶éƒ¨ä½ç½®)å¯è§†èŒƒå›´é«˜åº¦ ç›¸é™¤å³ï¼šå½“å‰å¯è§†èŒƒå›´å†…æœ€åä¸€ä¸ªitemåº•éƒ¨ç›¸å¯¹äºæ•´ä¸ªå¯è§†èŒƒå›´çš„é«˜åº¦æ¯”ä¾‹ã€‚
      local alpha = (item_bottom - scrollY) / (item_bottom - item_top)
      -- è®¡ç®—å½“å‰å¯è§†çš„itemViewåœ¨å±å¹•å†…çš„é«˜åº¦
      -- å…¬å¼ å½“å‰è§†å›¾é«˜åº¦å’Œitemåº•éƒ¨ä½ç½®ä¸­æœ€å°çš„å€¼(é˜²æ­¢å¯ç”¨æ¨ªå‘åŠŸèƒ½é”®åŠŸèƒ½å¤±æ•ˆ) å‡å» itemçš„é¡¶éƒ¨ä½ç½®
      local visibleItemHeight = math.min(height, item_bottom) - item_top

      -- å¦‚æœå¾—å‡ºçš„æ¯”ä¾‹å°äº0åˆ™æ‰§è¡Œä»£ç  å³ï¼šå½“å‰å¯è§†çš„itemè¶…å‡ºäº†å±å¹•ä¸Šæ–¹
      if alpha < 0 then
        -- é€æ˜åº¦æ¯”ä¾‹è®¾ç½®ä¸º itemé«˜åº¦+itemé¡¶éƒ¨ä½ç½® é™¤ä»¥itemçš„é«˜åº¦ å³ï¼šå¯è§†èŒƒå›´å†…ç¬¬ä¸€ä¸ªitemåœ¨æ•´ä¸ªitemé«˜åº¦ä¸Šçš„ä½ç½®æ¯”ä¾‹
        alpha = (item_height + item_top) / item_height
        -- å¦‚æœ itemåº•éƒ¨ä½ç½®å¤§äºitemé«˜åº¦åˆ™æ‰§è¡Œä»£ç  å³ï¼šå½“å‰å¯è§†çš„itemè¶…å‡ºäº†å±å¹•ä¸‹æ–¹
      elseif item_bottom > item_height then -- å¦ç±»æ–¹å¼ alpha > 1 then
        -- é€æ˜åº¦æ¯”ä¾‹è®¾ç½®ä¸º å½“å‰å¯è§†çš„itemé«˜åº¦é™¤ä»¥æ•´ä¸ªitemé«˜åº¦çš„æ¯”ä¾‹
        alpha = (visibleItemHeight / item_height)
      end
      -- è®¾ç½®å½“å‰itemç´¢å¼•ä½ç½®çš„é€æ˜åº¦
      itemView.setAlpha(alpha)

      -- å¦ç±»åº•éƒ¨itemæ·¡å…¥æ·¡å‡ºå®ç°æ–¹å¼
      -- å¦‚æœå½“å‰å¾ªç¯çš„itemä¸ºå¯è§†èŒƒå›´å†…æœ€åä¸€ä¸ªitemåˆ™æ‰§è¡Œä»£ç 
      -- if i == lastVisibleItem then
      --     alpha = (visibleItemHeight / item_height)
      --     itemView.setAlpha(alpha)
      -- end
    end
  end
}

-- æ‰¹é‡åˆ é™¤ç´¢å¼•åˆ—è¡¨
local batch_index = {}
-- å…ƒç´ å½“å‰çŠ¶æ€åˆ—è¡¨
local attributeStates = {}
-- æ‰¹é‡åˆ é™¤å¼€å…³å˜é‡
local batch_removal = nil


-- åˆ—è¡¨ç‚¹å‡»äº‹ä»¶
ids.list.onItemClick = function(l, v, p)
  if batch_removal then
    local index = p + 1
    if attributeStates[index] == nil or attributeStates[index] == "original" then
      -- å½“å‰å±æ€§ä¸ºåŸå§‹çŠ¶æ€ï¼Œä¿®æ”¹ä¸ºæ–°çŠ¶æ€
      data[index].TV_z.background = Back(0x79DBDBDB, 0x79DBDBDB,0) -- å°†TV_zçš„èƒŒæ™¯é¢œè‰²æ›´æ”¹
      attributeStates[index] = "modified"
      table.insert(batch_index, p)
    else
      -- å½“å‰å±æ€§ä¸ºæ–°çŠ¶æ€ï¼Œæ¢å¤ä¸ºåŸå§‹çŠ¶æ€
      data[index].TV_z.background = Back(0x00,0x79DBDBDB,0) -- æ¢å¤TV_zçš„åŸå§‹èƒŒæ™¯é¢œè‰²
      attributeStates[index] = "original"
      -- æ£€æŸ¥å…ƒç´ æ˜¯å¦å·²å­˜åœ¨äºè¡¨ä¸­
      local table_index = nil
      for i, value in ipairs(batch_index) do
        if value == p then
          table_index = i
          break
        end
      end
      -- å¦‚æœå…ƒç´ å·²å­˜åœ¨ï¼Œåˆ™ä»è¡¨ä¸­åˆ é™¤
      if table_index then
        table.remove(batch_index, table_index)
      end
    end
    adp.notifyDataSetChanged()
  else
    getNumStr(p)
    service.commitText(str)
  end
end




-- é•¿æŒ‰èœå•åŠŸèƒ½é”®
local function Bu_L(id)
  local but = {
  Button,
  textSize="12",
  layout_width="match_parent",
  layout_height="wrap_content",
  textColor=0xFFFFFFFF,
  -- ä¼ å…¥çš„åˆ†åˆ«æ˜¯ é»˜è®¤é¢œè‰² é«˜äº®é¢œè‰² åœ†è§’ æ¸å˜é¢œè‰² ä¸éœ€è¦æ¸å˜å¯è®¾ç½®ä¸ºnil
  Background=create_ripp(0xFF526FFF,0xFFF3603C,10,0xFF8099FF),
  layout_marginTop="5dp",
  layout_marginBottom="5dp",
  layout_marginLeft="5dp",
  layout_marginRight="5dp",
  }
-- è¯·å°†onClickåŠŸèƒ½å†™è¿›é•¿æŒ‰èœå•å‡½æ•°å†… ä¸ç„¶æ— ä¸Šä¸‹æ–‡main.removeView(menu)æ— æ³•ç§»é™¤å¸ƒå±€
  if id == 1 then
    but.text = "ç½®é¡¶"
    but.id = "but_1"
  elseif id == 2 then
    but.text = "æŸ¥çœ‹"
    but.id = "but_2"
  elseif id == 3 then
    but.text = "åˆ é™¤"
    but.id = "but_3"
  elseif id == 4 then
    but.text = "åˆ†è¯"
    but.id = "but_4"
  elseif id == 5 then
    but.text = "æ·»åŠ çŸ­è¯­"
    but.id = "but_5"
  elseif id == 6 then 
    but.text = "äºŒç»´ç "
    but.id = "but_6"
  elseif id == 7 then
    but.text = "ç™¾åº¦ç¿»è¯‘\n[é•¿æŒ‰è®¾ç½®]"
    but.id = "but_7"
  elseif id == 8 then
    but.text = "ä¸€é”®åŠ è¯\n[éœ€é…ç½®]"
    but.id = "but_8"
  elseif id == 9 then
    but.text = "æ¸…ç©ºè¯æ¡\n[è¯·é•¿æŒ‰]"
    but.id = "but_9"
  elseif id == 10 then
    but.text = "è¯­éŸ³æ’­æŠ¥"
    but.id = "but_10"
  elseif id == 11 then
    but.text = "ä¸Šå±é“¾æ¥[ä¸­è‹±]\né•¿æŒ‰[è‹±]"
    but.id = "but_11"
  elseif id == 12 then
    but.text = "æ‰¹é‡åˆ é™¤\n[é•¿æŒ‰åˆ é™¤]"
    but.id = "but_12"
  elseif id == 13 then
    but.text = "ç©º"
    but.id = "but_13"
  end
  return but
end



local æºè¯­è¨€=("auto")
local ç›®æ ‡è¯­è¨€=("auto")

function ara_sel(str)
    local table = {["è‡ªåŠ¨æ£€æµ‹"]="auto", ["ä¸­æ–‡"]="zh", ["è‹±æ–‡"]="en", ["æ—¥æ–‡"]="jp", ["éŸ©æ–‡"]="kor", ["æ³°æ–‡"]="th", ["ä¿„æ–‡"]="ru", ["å¾·æ–‡"]="fra", ["æ³•æ–‡"]="de",["ä¸­æ–‡ç¹ä½“"]="cht"}
    return table[str]
end


local fo_num = 0 -- æºè¯­è¨€é»˜è®¤é€‰æ‹©
local ed_num = 2 -- ç›®æ ‡è¯­è¨€é»˜è®¤é€‰æ‹©


-- Spinnerä¸‹æ‹‰æ¡†å†…å®¹ ç°å·²å¼ƒç”¨
-- æ³¨: Spinnerä¸æ”¯æŒä¿®æ”¹ä¸‹æ‹‰æ¡†é«˜åº¦å³dropDownHeight æ‰€æœ‰é€‰é¡¹å°†ä¸€æ¬¡æ€§å±•å¼€ å¯èƒ½é¡¶å‡ºå‰ªåˆ‡æ¿å¤–
function setAdap(idd)
local items = {"è‡ªåŠ¨æ£€æµ‹","ä¸­æ–‡","è‹±æ–‡","æ—¥æ–‡","éŸ©æ–‡","æ³°æ–‡","ä¿„æ–‡","å¾·æ–‡","æ³•æ–‡","ä¸­æ–‡ç¹ä½“"}
local txtview = {
  TextView,
  layout_width="match_parent",
  layout_height="wrap_content",
  textColor="#FF0A59F7",
  padding="5dp", -- ä¸‹æ‹‰æ¡†é€‰é¡¹è¾¹è·
  gravity="center",
  textSize="10sp",
  }
  local adap = LuaArrayAdapter(this,txtview)
  for i,n in pairs(items) do -- å°†itemså¾ªç¯æ·»åŠ è‡³é€‚é…å™¨
    adap.add(n)
  end
  idd.setAdapter(adap)
end

b_ed_text = nil -- æºè¯­è¨€æ ‡é¢˜
b_fo_text = nil -- ç›®æ ‡è¯­è¨€æ ‡é¢˜
data_ed_index = nil -- æºè¯­è¨€itemç´¢å¼•
data_fo_index = nil -- ç›®æ ‡è¯­è¨€itemç´¢å¼•

-- æ–°é•¿æŒ‰èœå•å¸ƒå±€
ids.list.onItemLongClick=function(l,v,p)
  local container = {
    FrameLayout,
    id = "mask",
    layout_width="match_parent",
    layout_height="match_parent",
    BackgroundColor="#49000000",
    {
      ScrollView,
      layout_width="wrap_content",
      layout_height="200dp",
      layout_gravity="center",
      Background=Back(0xFFFFFFFF,0xFFFFFFFF),
      {
        LinearLayout,-- æ°´å¹³çº¿æ€§å¸ƒå±€æ’åˆ—2ä¸ªå­å‚ç›´çº¿æ€§å¸ƒå±€
        orientation="horizontal",
        layout_width="match_parent",
        layout_height="wrap_content",
        {
          LinearLayout,
          orientation="vertical",
          layout_width="0dp",
          layout_height="wrap_content",
          layout_weight="1", -- å æ®ä¸€åŠå®½åº¦
          Bu_L(1),
          Bu_L(3),
          Bu_L(5),
          Bu_L(7),
          Bu_L(9),
          Bu_L(11),
          -- Bu_L(13),
        },
        {
          LinearLayout,
          orientation="vertical",
          layout_width="0dp",
          layout_height="wrap_content",
          layout_weight="1", -- å æ®ä¸€åŠå®½åº¦
          Bu_L(2),
          Bu_L(4),
          Bu_L(6),
          Bu_L(12),
          Bu_L(8),
          Bu_L(10),
        },
      },
    },
  }
  local menu = loadlayout(container)

  getNumStr(p)

  mask.onClick = function()
    main.removeView(menu) -- ç§»é™¤ èœå•å¸ƒå±€
  end

  but_1.onClick = function()
    Clip.remove(num)
    Clip.add(0,str)
    service.getSystemService(Context.CLIPBOARD_SERVICE).setText(str)
    fresh() -- ç›‘å¬äº†å‰ªåˆ‡æ¿äº‹ä»¶ï¼Œè‡ªåŠ¨ä¼šåˆ·
    main.removeView(menu)
  end

  but_2.onClick = function()
    local lay={TextView,
      padding="16dp",
      MaxLines=20,
      textIsSelectable=true,
      text=str,
      textColor=0xff232323,
      textSize="15dp"}
    LuaDialog(service)
    .setTitle(string.format("%s.  é¢„è§ˆ/æ“ä½œï¼ˆ%sï¼‰",num+1,utf8.len(str)))
    .setView(loadlayout(lay))
    .setButton("ç½®é¡¶",function()
      if p>0 then
        Clip.remove(num)
        Clip.add(0,str)
        service.getSystemService(Context.CLIPBOARD_SERVICE).setText(str)
        --fresh() ç›‘å¬äº†å‰ªåˆ‡æ¿äº‹ä»¶ï¼Œè‡ªåŠ¨ä¼šåˆ·æ–°
      end
    end)
    .setButton2("åˆ é™¤",function()
      Clip.remove(num)
      fresh()
      JsonUtil.save(File(æ–‡ä»¶), Clip) --åˆ·æ–°å‰ªåˆ‡æ¿jsonæ–‡ä»¶
    end)
    .setButton3("å–æ¶ˆ",function()
      dialog.dismiss()
    end)
    .show()
    main.removeView(menu)
  end

  but_3.onClick = function()
    Clip.remove(num)
    fresh()
    JsonUtil.save(File(æ–‡ä»¶), Clip) --åˆ·æ–°å‰ªåˆ‡æ¿jsonæ–‡ä»¶
    main.removeView(menu)
  end

  but_4.onClick = function()
    re_lo = false --é˜²æ­¢ è§†é¢‘é”€æ¯åé€€å‡ºè„šæœ¬
    å¯¼å…¥æ¨¡å—("åˆ†è¯å·¥å…·.text",str)
  end

  but_5.onClick = function()
    print(str.."æ·»åŠ æˆåŠŸ")
    local Phrase=service.getPhrase()
    Phrase.add(0,str)
    local Phrase_nr="[\n"
    for i=0,#Phrase-1 do
      Phrase0=Phrase[i]:gsub("\\","\\\\")
      Phrase0=Phrase0:gsub("/","\\/")
      Phrase0=Phrase0:gsub("\"","\\\"")
      Phrase0=Phrase0:gsub("\n","\\n")
      Phrase0=Phrase0:gsub("\t","\\t")
      Phrase_nr=Phrase_nr.."    \""..Phrase0.."\",\n"
    end
    Phrase_nr=Phrase_nr:sub(1,-3).."\n]"
    io.open(è¾“å…¥æ³•ç›®å½•.."phrase.json","w"):write(Phrase_nr):close()
    main.removeView(menu)
  end

  but_6.onClick = function()
    re_lo = false  --é˜²æ­¢ è§†é¢‘é”€æ¯åé€€å‡ºè„šæœ¬
    å¯¼å…¥æ¨¡å—("äºŒç»´ç åˆ¶ä½œ.text",str)
  end

  but_7.onClick = function()
    local url_tra="https://api.gmit.vip/Api/Translate?format=json&text="..str.."&from="..æºè¯­è¨€.."&to="..ç›®æ ‡è¯­è¨€
    Http.get(url_tra,function(a,b)
     if a==200 then
       json=import"cjson"
       local ç¿»è¯‘å†…å®¹=json.decode(b)["data"]["result"]
       service.commitText(ç¿»è¯‘å†…å®¹)
     end
    end)
  end

  but_7.onLongClick = function()
    if b_fo_text == nil then
      b_fo_text = "è‡ªåŠ¨æ£€æµ‹"
    end
    if b_ed_text == nil then
      b_ed_text = "ä¸­æ–‡"
    end
    local tra_set = {
      FrameLayout,
      id = "tra_mask",
      layout_width="match_parent",
      layout_height="match_parent",
      BackgroundColor="#49000000",
      {CardView,
        layout_width="fill",
        layout_height="40dp",
        layout_margin="2dp",
        radius="2dp",
        {
          LinearLayout,
          layout_width="fill",
          layout_height="40dp",
          orientation="horizontal",
          {
            Button,
            layout_width="0dp",
            layout_height="fill",
            id="b_tra_fo",
            text=b_fo_text,
            background=create_ripp(),
            layout_weight=1,
            layout_marginTop="5dp",
            layout_marginBottom="5dp",
            layout_marginLeft="5dp",
            layout_marginRight="5dp",
          },
          {
            Button,
            layout_width="0dp",
            layout_height="fill",
            id="b_tra_ed",
            text=b_ed_text,
            background=create_ripp(),
            layout_weight=1,
            layout_marginTop="5dp",
            layout_marginBottom="5dp",
            layout_marginLeft="5dp",
            layout_marginRight="5dp",
          },

          -- { -- æ—§ç‰ˆè¯­è¨€é€‰æ‹©æ–¹å¼ è‹¥è¦ä½¿ç”¨è¯·æ³¨é‡Šä¸Šæ–¹Buttonæ§ä»¶å¹¶å–æ¶ˆæœ‰å…³Spinnerçš„æ³¨é‡Š
          --   Spinner,
          --   id="tra_fo",
          --   layout_width="0dp",
          --   layout_height="fill",
          --   background=create_ripp(), -- é‡å†™èƒŒæ™¯éšè—å€’ä¸‰è§’
          --   layout_weight=1,
          --   layout_marginTop="5dp",
          --   layout_marginBottom="5dp",
          --   layout_marginLeft="5dp",
          --   layout_marginRight="5dp",
          -- },
          -- {
          --   Spinner,
          --   id="tra_ed",
          --   layout_width="0dp",
          --   layout_height="fill",
          --   background=create_ripp(), -- é‡å†™èƒŒæ™¯éšè—å€’ä¸‰è§’
          --   layout_weight=1,
          --   layout_marginTop="5dp",
          --   layout_marginBottom="5dp",
          --   layout_marginLeft="5dp",
          --   layout_marginRight="5dp",
          -- },
        },
      },
    }
    local tra_set_view = loadlayout(tra_set)

    -- setAdap(tra_fo)
    -- setAdap(tra_ed)
    -- tra_fo.setSelection(fo_num) --è®¾ç½®çš„é€‚é…å™¨é»˜è®¤é€‰é¡¹
    -- tra_ed.setSelection(ed_num)

    -- tra_fo.onItemSelected=function(l,v,p,i)
    --   æºè¯­è¨€ = ara_sel(v.Text) -- è·å–é€‰é¡¹æ–‡æœ¬ væŒ‡é€‰æ‹©çš„é€‰é¡¹ ara_selå‡½æ•°æ˜¯é€šè¿‡æ–‡æœ¬åˆ¤æ–­è¿”å›å€¼
    --   fo_num = p -- è·å–é€‰é¡¹ä½ç½® è®°å½•é€‰é¡¹ pé€‰æ‹©çš„ä½ç½® iç´¢å¼•
    -- end

    -- tra_ed.onItemSelected=function(l,v,p,i)
    --   ç›®æ ‡è¯­è¨€ = ara_sel(v.Text)
    --   ed_num = p
    -- end

    tra_mask.onClick = function()
      main.removeView(tra_set_view)
    end
    -- luaå±€éƒ¨å˜é‡ä»…é™äºå—ä¸­ elseçš„åˆ†æ”¯å±äºå¦ä¸€å—æ— æ³•è·å–å˜é‡ æ‰€ä»¥å†™åœ¨å‡½æ•°å¤–
    local lang_fo = {
      FrameLayout,
      id = "mask_fo",
      layout_width = "match_parent",
      layout_height = "match_parent",
      BackgroundColor = "#00000000",
      {
        LinearLayout,
        layout_marginTop = "45dp",
        layout_marginLeft = "66px",
        {
          ListView,
          id = "list_fo",
          layout_width = "415px", -- ä¿®æ”¹åè¯·å°†å…¶çˆ¶æ§ä»¶çš„layout_marginLeftä¸€èµ·ä¿®æ”¹
          layout_height = é»˜è®¤é«˜åº¦/1.4,
          background = Back(0xFFFFFFFF,0xFFFFFFFF,35),
          DividerHeight=0,
        },
      },
    }
    local demo_set_view = loadlayout(lang_fo)
    local data_fo = {}
    local item_fo = {
      LinearLayout,
      layout_width = "match_parent",
      id = "custom_layout_fo",
      gravity = "center",
      orientation = "vertical",
      {
        TextView,
        id = "custom_text_fo",
        textColor = 0xFF6282D2,
        textSize = "17dp",
        padding = "4dp",
      },
      {
        View,
        id = "divider", -- é«˜ä»¿åˆ†å‰²çº¿ ListViewä¸æ”¯æŒä¿®æ”¹åˆ†å‰²çº¿é¢œè‰²
        layout_width = "310px", -- åŒ…æ‹¬itemå†…å®¹å®½åº¦
        -- layout_height = "0dp", -- ä¸º0dpä¸å¯ç”¨
        layout_height = "1px",
      },
    }

    local adpat = LuaAdapter(service, data_fo, item_fo)
    list_fo.Adapter = adpat

    local items_demo = {"è‡ªåŠ¨æ£€æµ‹", "ä¸­æ–‡", "è‹±æ–‡", "æ—¥æ–‡", "éŸ©æ–‡", "æ³°æ–‡", "ä¿„æ–‡", "å¾·æ–‡", "æ³•æ–‡", "ä¸­æ–‡ç¹ä½“"}

    for i = 1, #items_demo do
      local itemData = {
        custom_layout_fo = { background = Back(0x00,0x79DBDBDB,35) },
        custom_text_fo = {Text = items_demo[i]},
        divider = { backgroundColor = 0xFFB3B3B3 },
      }
      table.insert(data_fo, itemData)
    end

    if data_fo_index == nil then
      data_fo_index = 1
    end
    -- é»˜è®¤é•¿äº®ä¸é»˜è®¤é€‰é¡¹æŒ‚å‹¾
    data_fo[data_fo_index].custom_layout_fo.background = Back(0xFFCBE6FC,0xFFCBE6FC,35)
    -- å»é™¤æœ€åä¸€æ¡å¤šä½™çš„åˆ†å‰²çº¿
    data_fo[#data_fo].divider.backgroundColor = 0x00
    adpat.notifyDataSetChanged()

    -- æ·»åŠ å±•å¼€åŠ¨ç”»
    function addExpandAnimation(view)
      -- æµ‹é‡å¸ƒå±€é«˜åº¦ é˜²æ­¢ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶è·å–ä¸åˆ°é«˜åº¦
      view.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED)
      -- è·å–é«˜åº¦
      local height = view.getMeasuredHeight()
      -- å‚æ•° 1. èµ·å§‹Xåæ ‡ 2. ç»“æŸXåæ ‡ 3. èµ·å§‹Yåæ ‡ 4. ç»“æŸYåæ ‡
      local animation = TranslateAnimation(0, 0, -height, 0)
      animation.duration = 100 -- åŠ¨ç”»æ—¶é•¿
      view.startAnimation(animation)
    end

    -- æ·»åŠ æ”¶èµ·åŠ¨ç”»
    function addCollapseAnimation(view)
      view.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED)
      local height = view.getMeasuredHeight()
      local animation = TranslateAnimation(0, 0, 0, -height)
      animation.duration = 100 -- åŠ¨ç”»æ—¶é•¿
      view.startAnimation(animation)
    end

    local isViewVisible = false
    b_tra_fo.onClick = function()
      mask_fo.onClick = function()
        addCollapseAnimation(demo_set_view)
        tra_set_view.removeView(demo_set_view)
        isViewVisible = false
      end

      if isViewVisible then
        addCollapseAnimation(demo_set_view)
        tra_set_view.removeView(demo_set_view)
      else
        addExpandAnimation(demo_set_view)
        tra_set_view.addView(demo_set_view)
      end
      isViewVisible = not isViewVisible
      return true
    end
    -- luaå±€éƒ¨å˜é‡ä»…é™äºå—ä¸­ elseçš„åˆ†æ”¯å±äºå¦ä¸€å—æ— æ³•è·å–å˜é‡ æ‰€ä»¥å†™åœ¨å‡½æ•°å¤–
    local lang_ed = {
      FrameLayout,
      id = "mask_ed",
      layout_width = "match_parent",
      layout_height = "match_parent",
      BackgroundColor = "#00000000",
      {
        LinearLayout,
        layout_marginTop = "45dp",
        layout_marginLeft = "600px",
        {
          ListView,
          id = "list_ed",
          layout_width = "415px", -- ä¿®æ”¹åè¯·å°†å…¶çˆ¶æ§ä»¶çš„layout_marginLeftä¸€èµ·ä¿®æ”¹
          layout_height = é»˜è®¤é«˜åº¦/1.4,
          background = Back(0xFFFFFFFF,0xFFFFFFFF,35),
          DividerHeight=0,
        },
      },
    }
    local demo_set_view_2 = loadlayout(lang_ed)
    local data_ed = {}
    local item_ed = {
      LinearLayout,
      layout_width = "match_parent",
      id = "custom_layout_ed",
      gravity = "center",
      orientation = "vertical",
      {
        TextView,
        id = "custom_text_ed",
        textColor = 0xFF6282D2,
        textSize = "17dp",
        padding = "4dp",
      },
      {
        View,
        id = "divider", -- é«˜ä»¿åˆ†å‰²çº¿ ListViewä¸æ”¯æŒä¿®æ”¹åˆ†å‰²çº¿é¢œè‰²
        layout_width = "310px", -- åŒ…æ‹¬itemå†…å®¹å®½åº¦
        -- layout_height = "0dp", -- ä¸º0dpä¸å¯ç”¨
        layout_height = "1px",
      },
    }

    local adpate = LuaAdapter(service, data_ed, item_ed)
    list_ed.Adapter = adpate

    for i = 1, #items_demo do
      local itemData = {
        custom_layout_ed = { background = Back(0x00,0x79DBDBDB,35) },
        custom_text_ed = {Text = items_demo[i]},
        divider = { backgroundColor = 0xFFB3B3B3 },
      }
      table.insert(data_ed, itemData)
    end

    if data_ed_index == nil then
      data_ed_index = 2
    end
    -- é»˜è®¤é•¿äº®ä¸é»˜è®¤é€‰é¡¹æŒ‚å‹¾
    data_ed[data_ed_index].custom_layout_ed.background = Back(0xFFCBE6FC,0xFFCBE6FC,35)
    -- å»é™¤æœ€åä¸€æ¡å¤šä½™çš„åˆ†å‰²çº¿
    data_ed[#data_ed].divider.backgroundColor = 0x00
    adpate.notifyDataSetChanged()

    local isViewVisible_2 = false
    b_tra_ed.onClick = function()
      mask_ed.onClick = function()
        addCollapseAnimation(demo_set_view_2)
        tra_set_view.removeView(demo_set_view_2)
        isViewVisible_2 = false
      end

      if isViewVisible_2 then
        addCollapseAnimation(demo_set_view_2)
        tra_set_view.removeView(demo_set_view_2)
      else
        addExpandAnimation(demo_set_view_2)
        tra_set_view.addView(demo_set_view_2)
      end
      isViewVisible_2 = not isViewVisible_2
      return true
    end

    -- æºèªè¨€åˆ—è¡¨ç‚¹å‡»äº‹ä»¶
    list_fo.onItemClick = function(l, v, p)
      -- è·å–é€‰æ‹©çš„å†…å®¹çš„æ–‡æœ¬
      local selectedItem = data_fo[p+1].custom_text_fo.Text
      æºè¯­è¨€ = ara_sel(selectedItem)
      b_tra_fo.setText(selectedItem) -- å°†é€‰æ‹©çš„å†…å®¹è®¾ç½®ä¸ºæŒ‰é’®æ–‡æœ¬
      b_fo_text = selectedItem -- è®°å½•æ–‡æœ¬é˜²æ­¢é€€å‡ºé€‰é¡¹åæ–‡æœ¬é‡ç½®
      -- å–æ¶ˆä¸Šæ¬¡é€‰æ‹©çš„é•¿äº®
      if data_fo_index ~= nil then
        data_fo[data_fo_index].custom_layout_fo.background = Back(0x00,0x00,35)
      end
      data_fo_index = p+1
      -- é•¿äº®é€‰æ‹©
      data_fo[data_fo_index].custom_layout_fo.background = Back(0xFFCBE6FC,0xFFCBE6FC,35)
      adpat.notifyDataSetChanged()
      addCollapseAnimation(demo_set_view) -- æ”¶èµ·åŠ¨ç”»
      tra_set_view.removeView(demo_set_view) -- ç§»é™¤å¸ƒå±€
      isViewVisible = false
    end

    -- ç›®æ ‡è¯­è¨€ç‚¹å‡»äº‹ä»¶
    list_ed.onItemClick = function(l, v, p)
      -- è·å–é€‰æ‹©çš„å†…å®¹çš„æ–‡æœ¬
      local selectedItem = data_ed[p+1].custom_text_ed.Text
      ç›®æ ‡è¯­è¨€ = ara_sel(selectedItem)
      b_tra_ed.setText(selectedItem) -- å°†é€‰æ‹©çš„å†…å®¹è®¾ç½®ä¸ºæŒ‰é’®æ–‡æœ¬
      b_ed_text = selectedItem -- è®°å½•æ–‡æœ¬é˜²æ­¢é€€å‡ºé€‰é¡¹åæ–‡æœ¬é‡ç½®
      -- å–æ¶ˆä¸Šæ¬¡é€‰æ‹©çš„é•¿äº®
      if data_ed_index ~= nil then
        data_ed[data_ed_index].custom_layout_ed.background = Back(0x00,0x00,35)
      end
      data_ed_index = p+1
      -- é•¿äº®é€‰æ‹©
      data_ed[data_ed_index].custom_layout_ed.background = Back(0xFFCBE6FC,0xFFCBE6FC,35)
      adpate.notifyDataSetChanged()
      addCollapseAnimation(demo_set_view_2) -- æ”¶èµ·åŠ¨ç”»
      tra_set_view.removeView(demo_set_view_2) -- ç§»é™¤å¸ƒå±€
      isViewVisible_2 = false
    end

    main.addView(tra_set_view)
    return true
  end

  but_8.onClick = function()
    å¯¼å…¥æ¨¡å—("ä¸€é”®åŠ è¯è‡ªåŠ¨ç¼–ç (å®šé•¿).text",str)
    main.removeView(menu)
  end
  
  but_9.onLongClick = function()
    local whether={TextView,
      padding="16dp",
      MaxLines=20,
      textIsSelectable=true,
      text="æ‰§è¡ŒåŠŸèƒ½åå‰ªåˆ‡æ¿æ‰€æœ‰å†…å®¹å°†è¢«æ¸…ç©ºï¼è¯·ä¸‰æ€ï¼",
      textColor=0xff232323,
      textSize="15dp"}
    LuaDialog(service)
    .setTitle(string.format("ä½ ç¡®å®šè¦æ¸…ç©ºå‰ªåˆ‡æ¿å—ï¼Ÿ"))
    .setView(loadlayout(whether))
    .setButton("ç¡®å®š",function()
      pcall(function()
      --pcallé‡Œé˜²æŠ¥é”™
        æ¢å¤çŠ¶æ€æ ()
      end)
      io.open(æ–‡ä»¶,"w"):write("[\n]"):close()
      local è¾“å…¥æ³•å®ä¾‹=Trime.getService()
      è¾“å…¥æ³•å®ä¾‹.loadClipboard()
      print("æ•°æ®å·²æ¸…é™¤")
      re_lo = false
      service.setKeyboard(".default")
    end)
    .setButton2("å–æ¶ˆ",function()
      dialog.dismiss()
    end)
    .show()
  end
  
  but_10.onClick = function()
    service.speak(str)--æ–‡æœ¬è½¬å£°éŸ³
    main.removeView(menu)
  end

  but_11.onClick = function()
    str = string.gsub(str, "[^%a%d%p:/.-]", "")
    str = string.match(str, "[https?://]?[%a%d%p:/.-]*")
    service.commitText(str)
    main.removeView(menu)
  end

  but_11.onLongClick = function()
    str = string.match(str, "[https?://]?[%a%d%p:/.-]*")
    service.commitText(str)
    main.removeView(menu)
  end


  but_12.onClick=function()
    if batch_removal then
      batch_removal = false
      batch_index = {} -- æ¸…ç©ºæ‰€é€‰å¾…åˆ é™¤çš„å†…å®¹ç´¢å¼•
      attributeStates = {} -- æ¸…ç©ºæ‰€æœ‰é€‰é¡¹çŠ¶æ€
      fresh() -- åˆ·æ–°åˆ—è¡¨é‡ç½®é«˜äº®çŠ¶æ€
      print("æ‚¨å·²ç¦ç”¨æ‰¹é‡åˆ é™¤")
    else
      batch_removal = true
      print("æ‚¨å·²å¯ç”¨æ‰¹é‡åˆ é™¤\né•¿æŒ‰æ­¤æŒ‰é’®å³å¯åˆ é™¤å†…å®¹\nå†æ¬¡ç‚¹å‡»å³å¯ç¦ç”¨æ‰¹é‡åˆ é™¤")
    end
  end

  but_12.onLongClick = function()
    if #batch_index == 0 then
      print("æ‚¨æ²¡æœ‰é€‰æ‹©ä»»ä½•å†…å®¹\nè¯·å…ˆç‚¹æŒ‰å¯ç”¨æ‰¹é‡åˆ é™¤\nå†ç‚¹æŒ‰åˆ—è¡¨ä¸­çš„å†…å®¹å³å¯é€‰æ‹©")
    else
      table.sort(batch_index) -- ä»å°åˆ°å¤§æ­£åºæ’åº
      -- -- å…ˆå€’åºæ’åºå†æ­£åºéå‰ è‡³äºä¸ºä»€ä¹ˆå†™ç§ä¸¤æ–¹å¼å› ä¸ºæˆ‘åœ¨æµ‹æœ‰æ²¡æœ‰BUG
      --   table.sort(batch_index, function(a, b) return a > b end) -- å€’åºæ’åº
      --   for i = 1, #batch_index do -- æ­£åºéå‰
      for i = #batch_index, 1, -1 do -- å€’åºéå‰
        Clip.remove(batch_index[i])
      end
      fresh()
      JsonUtil.save(File(æ–‡ä»¶), Clip) --åˆ·æ–°å‰ªåˆ‡æ¿jsonæ–‡ä»¶
      batch_index = {} -- æ¸…ç©ºæ‰€é€‰å¾…åˆ é™¤çš„å†…å®¹ç´¢å¼•
      attributeStates = {} -- æ¸…ç©ºæ‰€æœ‰é€‰é¡¹çŠ¶æ€
      batch_removal = false
    end
    return true
  end

  -- but_13.onClick = function()
  --   print("test")
  -- end 

  main.addView(menu) -- å°†å¸ƒå±€æ·»åŠ è‡³æœ€é«˜å±‚

  return true
end

--[[
-- åŸé•¿æŒ‰èœå•------------å¼€å§‹------------

ids.list.onItemLongClick=function(l,v,p)
  getNumStr(p)
  pop=PopupMenu(service,v)
  menu=pop.Menu
  menu.add("ç½®é¡¶").onMenuItemClick=function(ae)
    Clip.remove(num)
    Clip.add(0,str)
    service.getSystemService(Context.CLIPBOARD_SERVICE).setText(str)
    fresh() -- ç›‘å¬äº†å‰ªåˆ‡æ¿äº‹ä»¶ï¼Œè‡ªåŠ¨ä¼šåˆ·æ–°
  end
  menu.add("æŸ¥çœ‹").onMenuItemClick=function(ae)
    local lay={TextView,
    padding="16dp",
    MaxLines=20,
    textIsSelectable=true,
    text=str,
    textColor=0xff232323,
    textSize="15dp"}
    LuaDialog(service)
    .setTitle(string.format("%s.  é¢„è§ˆ/æ“ä½œï¼ˆ%sï¼‰",num+1,utf8.len(str)))
    .setView(loadlayout(lay))
    .setButton("ç½®é¡¶",function()
      if p>0 then
        Clip.remove(num)
        Clip.add(0,str)
        service.getSystemService(Context.CLIPBOARD_SERVICE).setText(str)
        --fresh() ç›‘å¬äº†å‰ªåˆ‡æ¿äº‹ä»¶ï¼Œè‡ªåŠ¨ä¼šåˆ·æ–°
      end
    end)
    .setButton2("åˆ é™¤",function()
      Clip.remove(num)
      fresh()
      JsonUtil.save(File(æ–‡ä»¶), Clip) --åˆ·æ–°å‰ªåˆ‡æ¿jsonæ–‡ä»¶
    end)
    .setButton3("å–æ¶ˆ",function()
      dialog.dismiss()
    end)
    .show()
  end
  menu.add("åˆ†å‰²").onMenuItemClick=function(ae)
    å¯¼å…¥æ¨¡å—("åˆ†è¯å·¥å…·.text",str)
  end
  menu.add("åˆ é™¤").onMenuItemClick=function(ae)
    Clip.remove(num)
    fresh()
    JsonUtil.save(File(æ–‡ä»¶), Clip) --åˆ·æ–°å‰ªåˆ‡æ¿jsonæ–‡ä»¶
  end
  menu.add("ğŸš®æ¸…ç©ºè¯æ¡").onMenuItemClick=function(ae)
    pcall(function()
    --pcallé‡Œé˜²æŠ¥é”™
      æ¢å¤çŠ¶æ€æ ()
    end)
    io.open(æ–‡ä»¶,"w"):write("[\n]"):close()
    local è¾“å…¥æ³•å®ä¾‹=Trime.getService()
    è¾“å…¥æ³•å®ä¾‹.loadClipboard()
    print("æ•°æ®å·²æ¸…é™¤")
    service.setKeyboard(".default")
  end
  menu.add("ğŸ“¤ä¸Šä¼ äº‘ç«¯").onMenuItemClick=function(ae)
    å¯¼å…¥æ¨¡å—("æ¨é€å‰ªåˆ‡æ¿åˆ°äº‘ç«¯.text",str)
  end
  menu.add("ğŸ“æ·»åŠ çŸ­è¯­").onMenuItemClick=function(ae)
    print(str.."æ·»åŠ æˆåŠŸ")
    local Phrase=service.getPhrase()
    Phrase.add(0,str)
    local Phrase_nr="[\n"
    for i=0,#Phrase-1 do
      Phrase0=Phrase[i]:gsub("\\","\\\\")
      Phrase0=Phrase0:gsub("/","\\/")
      Phrase0=Phrase0:gsub("\"","\\\"")
      Phrase0=Phrase0:gsub("\n","\\n")
      Phrase0=Phrase0:gsub("\t","\\t")
      Phrase_nr=Phrase_nr.."    \""..Phrase0.."\",\n"
    end
    Phrase_nr=Phrase_nr:sub(1,-3).."\n]"
    io.open(è¾“å…¥æ³•ç›®å½•.."phrase.json","w"):write(Phrase_nr):close()
  end
  menu.add("ğŸ“‹ä¸€é”®åŠ è¯").onMenuItemClick=function(ae)
    å¯¼å…¥æ¨¡å—("ä¸€é”®åŠ è¯è‡ªåŠ¨ç¼–ç (å®šé•¿).text",str)
  end
  menu.add("ğŸ—£è¯­éŸ³æ’­æŠ¥").onMenuItemClick=function(ae)
    service.speak(str)--æ–‡æœ¬è½¬å£°éŸ³
  end
  menu.add("ğŸ“‡ç”ŸæˆäºŒç»´ç ").onMenuItemClick=function(ae)
    å¯¼å…¥æ¨¡å—("äºŒç»´ç åˆ¶ä½œ.text",str)
  end
  pop.show()
  return true
end

-- åŸé•¿æŒ‰èœå•------------ç»“æŸ------------
]]


-- ids.title.onClick=function()
  -- å¯¼å…¥æ¨¡å—("ä»äº‘ç«¯è·å–å‰ªåˆ‡æ¿.text","")
-- end

fresh()
func_fresh = fresh
if å…¨_br == nil then
  å‰ªåˆ‡æ¿æ·»åŠ å¹¿æ’­()
end
service.setKeyboard(main)

pcall(function()
  --pcallé‡Œé˜²æŠ¥é”™
  éšè—çŠ¶æ€æ (main)
end)


-- é»˜è®¤è§†é¢‘å’Œé»˜è®¤èƒŒæ™¯å›¾------------å¼€å§‹------------


local bgmv_path = ç›®å½•.."bg.mp4" -- è§†é¢‘èƒŒæ™¯è·¯å¾„
local bg_pn = ç›®å½•.."bg_frame.jpg" -- å›¾ç‰‡èƒŒæ™¯è·¯å¾„

-- å›¾ç‰‡èƒŒæ™¯
if File(bg_pn).isFile() == true then
  -- å°†å¸ƒå±€æ·»åŠ è‡³layoutæœ€åº•å±‚(0)
  main.addView(loadlayout
    {
      ImageView,
      src = bg_pn,
      --adjustViewBounds="true",--ä¿æŒé•¿å®½æ¯”
      scaleType = "fitXY", -- æ¨ªå‘çºµå‘ç¼©æ”¾
      layout_width = -1,
      layout_height = -1
  },0)
end
-- è§†é¢‘èƒŒæ™¯
if File(bgmv_path).isFile() == true then
  pcall(function()
    local play = MediaPlayer()
    play.setDataSource(bgmv_path)
    play.setLooping(true)
    play.prepareAsync()
    play.setVolume(0,0) -- è§†é¢‘å£°éŸ³ å·¦å£°é“ å³å£°é“ å°†0æ”¹ä¸º1å³ç”Ÿæ•ˆ
    local video = loadlayout {
      SurfaceView,
      -- æ·»åŠ èƒŒæ™¯è‰²ï¼Œé¿å…çœ‹ä¸æ¸…æŒ‰é”®
      -- BackgroundColor=0x55ffffff,
      -- çº¿æ€§æ¸å˜ï¼Œ"TL_BR"ä¸ºtopleft bottomright
      -- backgroundDrawable=gradientDrawable("TL_BR",{0x99FBE0B5,0x99E5EED9,0x99F3F5F8}),--èƒŒæ™¯è‰²
      layout_width = -1,
      layout_height = -1
    }
    -- ä¸ç­‰å¾…å»¶è¿Ÿ(è§†é¢‘åŠ è½½)ç›´æ¥æå‰è¿›å…¥å¸ƒå±€è§†é¢‘åŠ è½½å¥½åè‡ªåŠ¨æ·»åŠ è§†é¢‘èƒŒæ™¯ (æ˜¾ç¤ºä¸ºå›¾ç‰‡èƒŒæ™¯ å¦‚æœæ— å›¾ç‰‡åˆ™ä¸åŠ è½½è§†é¢‘æ˜¾ç¤ºä¸ºé»˜è®¤ä¸»é¢˜èƒŒæ™¯) èƒŒæ™¯æ˜¯è§†é¢‘ç¬¬ä¸€å¸§çš„è¯æœ‰å¥‡æ•ˆ
    main.post{run=function() 
      main.addView(video, 1) -- æŠŠè§†é¢‘å¸ƒå±€æ”¾åˆ°layoutçš„ç¬¬äºŒå±‚ ç¬¬ä¸€å±‚ç•™ç»™å›¾ç‰‡
    end} -- æŠŠè¿™è¡Œå’Œå‰2è¡Œ æ³¨é‡Šå³å¯å–æ¶ˆæå‰è¿›å…¥å¸ƒå±€
    -- å®é™…è¿™2è¡Œä»£ç æ²¡ç”¨(æŒ‡æ”¾åœ¨è¿™é‡Œ),addViewå·²ç»æŠŠæ§ä»¶æ·»åŠ åœ¨åˆé€‚çš„å¸ƒå±€å±‚çº§ä¸Šäº†ã€‚
    -- video.setZOrderOnTop(true) -- æŠŠsurfaceViewçš„å¸ƒå±€å±‚è®¾ä¸ºæœ€é«˜å±‚
    -- video.setZOrderMediaOverlay(true) -- ä¸è¦†ç›–å…¶ä»–æ§ä»¶   video.setZOrderOnTop(false)ä¹Ÿè¡Œ é¡¾åæ€ä¹‰falseå°±æ˜¯å…³
    video.getHolder().addCallback({
      surfaceCreated = function(holder) --surfaceViewåˆ›å»ºå¼€å§‹å

      end,
      surfaceChanged = function(holder, format, width, height) -- surfaceView å¸ƒå±€å‘ç”Ÿå˜åŒ–æ—¶
        play.setDisplay(holder)
        play.start()
        -- ä»¥ä¸‹å»¶è¿Ÿæ ¹æ® å‰ªåˆ‡æ¿è¡Œæ•°ã€è§†é¢‘ã€é…ç½®ç­‰ ä½œå‚è€ƒ æ€§èƒ½è¶Šå¥½èƒ½è€—è¶Šå°‘ éœ€è¦çš„å»¶è¿Ÿè¶ŠçŸ­
        -- æå‰å»¶è¿Ÿå‡å°‘ while çš„èƒ½è€— è§†é¢‘è¿‡å¤§å¯ç”¨(æŒ‡ä½ whileåˆ°ä¼šå´©çš„æ—¶å€™) ä¸å´©è¿˜ç”¨åè€Œé™ä½é€Ÿåº¦ ä¹Ÿåˆ«è®¾å¤ªé«˜é™ä½é€Ÿåº¦åªè¦ä¸å´©å°±è¡Œ
        -- os.execute("sleep 1")-- è¿™äº›å»¶å»¶ä¼šç›´æ¥æš‚åœä»£ç     å‰ªåˆ‡æ¿çš„ä¸€äº›åŠŸèƒ½ ä¼šåœ¨ç¡çœ (å»¶è¿Ÿ)ç»“æŸåå†è¿è¡Œ
        -- å¾ªç¯è‡³è§†é¢‘æ’­æ”¾1æ¯«ç§’æ—¶ é˜²æ­¢è§†é¢‘åŠ è½½é—ªé»‘å±å’Œæ¯ä¸ªäººç¯å¢ƒä¸ä¸€ä¸é€šç”¨é—®é¢˜
        while play.getCurrentPosition() <= 1 do
          os.execute("sleep 0.1") --æ¯å¾ªç¯1æ¬¡æš‚åœ0.1ç§’ å‡å°‘èƒ½è€—å’Œé˜²æ­¢è¿‡å¤šå¾ªç¯å´©æºƒ
        end
      end,
      surfaceDestroyed = function() -- surfaceViewé”€æ¯å‰
        -- é‡Šæ”¾èµ„æº å°†è¿™ä¸‰è¡Œä»£ç æ³¨é‡Š å°±èƒ½åœ¨ä¸é€€å‡ºå‰ªåˆ‡æ¿çš„æƒ…å†µä¸‹ï¼Œå…³é—­é”®ç›˜(å³åˆ‡æ¢åº”ç”¨)å†æ‰“å¼€æ—¶é‡æ–°åŠ è½½ä¸ºè§†é¢‘ è®°å¾—æŠŠåº•ä¸‹å›åˆ°ä¸»é”®ç›˜å’ŒçŠ¶æ€æ ä¹Ÿæ³¨é‡Š
        play.stop() --é˜²æ­¢é€€å‡ºè„šæœ¬æ—¶ é—ªé»‘å±
        play.release()
        video.setZOrderOnTop(true) --æŠŠsurfaceViewçš„æ§ä»¶å¸ƒå±€å±‚çº§è®¾ç½®ä¸ºæœ€é«˜ï¼Œé˜²æ­¢ä¸Šé¢é‚£ä¸ªæƒ…å†µä¸‹ï¼ŒèƒŒæ™¯ä¸ºé»‘è€Œä¸æ˜¯ä½ çš„é”®ç›˜èƒŒæ™¯ã€‚

        -- -- 2. æ’­æ”¾è§†é¢‘æ—¶åˆ‡æ¢åº”ç”¨(å³ä¸é€€å‡ºå‰ªå‰ªæ¿æ—¶å…³é—­é”®ç›˜) è¿”å›ä¸»é”®ç›˜å¹¶æ¢å¤çŠ¶æ€æ  å°‘éƒ¨åˆ†è½¯ä»¶ä¸€äº›åŠŸèƒ½æœ‰æ¦‚ç‡ä¼šç›´æ¥å†æ¬¡è°ƒç”¨é”®ç›˜å¯¼è‡´ è¿”å›2æ¬¡å´©æºƒ æ‰€ä»¥ä¸æ¨èä½¿ç”¨äº†
        -- if re_lo then -- é˜²æ­¢ç‚¹å‡»è¿”å›æ—¶è§†é¢‘èƒŒæ™¯è‡ªåŠ¨è¿”å›2æ¬¡ç›´æ¥å´©æºƒ
        --     service.setKeyboard(".default")
        --     pcall(function()
        --       --pcallé‡Œé˜²æŠ¥é”™
        --       æ¢å¤çŠ¶æ€æ ()
        --     end)
        -- end -- è¿”å›ä¸»é”®ç›˜å¹¶æ¢å¤çŠ¶æ€æ ç»“æŸ
      end
    })
  end)
end

-- é»˜è®¤è§†é¢‘å’Œé»˜è®¤èƒŒæ™¯å›¾------------ç»“æŸ------------
